<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RiskFactorAggregateIR.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DROP</a> &gt; <a href="index.source.html" class="el_package">org.drip.simm20.margin</a> &gt; <span class="el_source">RiskFactorAggregateIR.java</span></div><h1>RiskFactorAggregateIR.java</h1><pre class="source lang-java linenums">
package org.drip.simm20.margin;

/*
 * -*- mode: java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 */

/*!
 * Copyright (C) 2018 Lakshmi Krishnamurthy
 * 
 *  This file is part of DRIP, a free-software/open-source library for buy/side financial/trading model
 *  	libraries targeting analysts and developers
 *  	https://lakshmidrip.github.io/DRIP/
 *  
 *  DRIP is composed of four main libraries:
 *  
 *  - DRIP Fixed Income - https://lakshmidrip.github.io/DRIP-Fixed-Income/
 *  - DRIP Asset Allocation - https://lakshmidrip.github.io/DRIP-Asset-Allocation/
 *  - DRIP Numerical Optimizer - https://lakshmidrip.github.io/DRIP-Numerical-Optimizer/
 *  - DRIP Statistical Learning - https://lakshmidrip.github.io/DRIP-Statistical-Learning/
 * 
 *  - DRIP Fixed Income: Library for Instrument/Trading Conventions, Treasury Futures/Options,
 *  	Funding/Forward/Overnight Curves, Multi-Curve Construction/Valuation, Collateral Valuation and XVA
 *  	Metric Generation, Calibration and Hedge Attributions, Statistical Curve Construction, Bond RV
 *  	Metrics, Stochastic Evolution and Option Pricing, Interest Rate Dynamics and Option Pricing, LMM
 *  	Extensions/Calibrations/Greeks, Algorithmic Differentiation, and Asset Backed Models and Analytics.
 * 
 *  - DRIP Asset Allocation: Library for model libraries for MPT framework, Black Litterman Strategy
 *  	Incorporator, Holdings Constraint, and Transaction Costs.
 * 
 *  - DRIP Numerical Optimizer: Library for Numerical Optimization and Spline Functionality.
 * 
 *  - DRIP Statistical Learning: Library for Statistical Evaluation and Machine Learning.
 * 
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   	you may not use this file except in compliance with the License.
 *   
 *  You may obtain a copy of the License at
 *  	http://www.apache.org/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  	distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  See the License for the specific language governing permissions and
 *  	limitations under the License.
 */

/**
 * RiskFactorAggregateIR holds the Sensitivity Margin Aggregates for each of the IR Risk Factors - OIS, LIBOR
 *  1M, LIBOR 3M, LIBOR 6M LIBOR 12M, PRIME, and MUNICIPAL. The References are:
 *  
 *  - Andersen, L. B. G., M. Pykhtin, and A. Sokol (2017): Credit Exposure in the Presence of Initial Margin,
 *  	https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2806156, eSSRN.
 *  
 *  - Albanese, C., S. Caenazzo, and O. Frankel (2017): Regression Sensitivities for Initial Margin
 *  	Calculations, https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2763488, eSSRN.
 *  
 *  - Anfuso, F., D. Aziz, P. Giltinan, and K. Loukopoulus (2017): A Sound Modeling and Back-testing
 *  	Framework for Forecasting Initial Margin Requirements,
 *  	https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2716279, eSSRN.
 *  
 *  - Caspers, P., P. Giltinan, R. Lichters, and N. Nowaczyk (2017): Forecasting Initial Margin Requirements
 *  	- A Model Evaluation https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2911167, eSSRN.
 *  
 *  - International Swaps and Derivatives Association (2017): SIMM v2.0 Methodology,
 *  	https://www.isda.org/a/oFiDE/isda-simm-v2.pdf.
 * 
 * @author Lakshmi Krishnamurthy
 */

public class RiskFactorAggregateIR
{
<span class="nc" id="L74">	private double _concentrationRiskFactor = java.lang.Double.NaN;</span>
<span class="nc" id="L75">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _oisSensitivityMargin = null;</span>
<span class="nc" id="L76">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _primeSensitivityMargin = null;</span>
<span class="nc" id="L77">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _libor1MSensitivityMargin = null;</span>
<span class="nc" id="L78">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _libor3MSensitivityMargin = null;</span>
<span class="nc" id="L79">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _libor6MSensitivityMargin = null;</span>
<span class="nc" id="L80">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _libor12MSensitivityMargin = null;</span>
<span class="nc" id="L81">	private java.util.Map&lt;java.lang.String, java.lang.Double&gt; _municipalSensitivityMargin = null;</span>

	/**
	 * RiskFactorAggregateIR Constructor
	 * 
	 * @param oisSensitivityMargin The OIS Sensitivity Margin
	 * @param libor1MSensitivityMargin The LIBOR 1M Sensitivity Margin
	 * @param libor3MSensitivityMargin The LIBOR 3M Sensitivity Margin
	 * @param libor6MSensitivityMargin The LIBOR 6M Sensitivity Margin
	 * @param libor12MSensitivityMargin The LIBOR 12M Sensitivity Margin
	 * @param primeSensitivityMargin The PRIME Sensitivity Margin
	 * @param municipalSensitivityMargin The Municipal Sensitivity Margin
	 // * @param sensitivityMargin The Bucket Sensitivity Margin
	 * @param concentrationRiskFactor The Currency's Concentration Risk Factor
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public RiskFactorAggregateIR (
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMargin,
		final java.util.Map&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMargin,
		final double concentrationRiskFactor)
		throws java.lang.Exception
<span class="nc" id="L109">	{</span>
<span class="nc bnc" id="L110" title="All 6 branches missed.">		if (null == (_oisSensitivityMargin = oisSensitivityMargin) || 0 == _oisSensitivityMargin.size() ||</span>
			null == (_libor1MSensitivityMargin = libor1MSensitivityMargin) ||
<span class="nc bnc" id="L112" title="All 4 branches missed.">				0 == _libor1MSensitivityMargin.size() ||</span>
			null == (_libor3MSensitivityMargin = libor3MSensitivityMargin) ||
<span class="nc bnc" id="L114" title="All 4 branches missed.">				0 == _libor3MSensitivityMargin.size() ||</span>
			null == (_libor6MSensitivityMargin = libor6MSensitivityMargin) ||
<span class="nc bnc" id="L116" title="All 4 branches missed.">				0 == _libor6MSensitivityMargin.size() ||</span>
			null == (_libor12MSensitivityMargin = libor12MSensitivityMargin) ||
<span class="nc bnc" id="L118" title="All 4 branches missed.">				0 == _libor12MSensitivityMargin.size() ||</span>
			null == (_municipalSensitivityMargin = municipalSensitivityMargin) ||
<span class="nc bnc" id="L120" title="All 4 branches missed.">				0 == _municipalSensitivityMargin.size() ||</span>
			null == (_primeSensitivityMargin = primeSensitivityMargin) ||
<span class="nc bnc" id="L122" title="All 2 branches missed.">				0 == _primeSensitivityMargin.size() ||</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">			!org.drip.quant.common.NumberUtil.IsValid (_concentrationRiskFactor = concentrationRiskFactor))</span>
		 {
<span class="nc" id="L125">			 throw new java.lang.Exception (&quot;RiskFactorAggregateIR Constructor =&gt; Invalid Inputs&quot;);</span>
		 }
<span class="nc" id="L127">	}</span>

	/**
	 * Retrieve the OIS Sensitivity Margin Map
	 * 
	 * @return The OIS Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMargin()
	{
<span class="nc" id="L137">		return _oisSensitivityMargin;</span>
	}

	/**
	 * Retrieve the LIBOR 1M Sensitivity Margin Map
	 * 
	 * @return The LIBOR 1M Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMargin()
	{
<span class="nc" id="L148">		return _libor1MSensitivityMargin;</span>
	}

	/**
	 * Retrieve the LIBOR 3M Sensitivity Margin Map
	 * 
	 * @return The LIBOR 3M Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMargin()
	{
<span class="nc" id="L159">		return _libor3MSensitivityMargin;</span>
	}

	/**
	 * Retrieve the LIBOR 6M Sensitivity Margin Map
	 * 
	 * @return The LIBOR 6M Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMargin()
	{
<span class="nc" id="L170">		return _libor6MSensitivityMargin;</span>
	}

	/**
	 * Retrieve the LIBOR 12M Sensitivity Margin Map
	 * 
	 * @return The LIBOR 12M Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMargin()
	{
<span class="nc" id="L181">		return _libor12MSensitivityMargin;</span>
	}

	/**
	 * Retrieve the PRIME Sensitivity Margin Map
	 * 
	 * @return The PRIME Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMargin()
	{
<span class="nc" id="L192">		return _primeSensitivityMargin;</span>
	}

	/**
	 * Retrieve the MUNICIPAL Sensitivity Margin Map
	 * 
	 * @return The MUNICIPAL Sensitivity Margin Map
	 */

	public java.util.Map&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMargin()
	{
<span class="nc" id="L203">		return _municipalSensitivityMargin;</span>
	}

	/**
	 * Retrieve the Bucket Concentration Risk Factor
	 * 
	 * @return The Bucket Concentration Risk Factor
	 */

	public double concentrationRiskFactor()
	{
<span class="nc" id="L214">		return _concentrationRiskFactor;</span>
	}

	/**
	 * Compute the Cumulative OIS Sensitivity Margin
	 * 
	 * @return The Cumulative OIS Sensitivity Margin
	 */

	public double cumulativeOISSensitivityMargin()
	{
<span class="nc" id="L225">		double cumulativeOISSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L228" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L230">			cumulativeOISSensitivityMargin = cumulativeOISSensitivityMargin +</span>
<span class="nc" id="L231">				oisSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L232">		}</span>

<span class="nc" id="L234">		return cumulativeOISSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative LIBOR1M Sensitivity Margin
	 * 
	 * @return The Cumulative LIBOR1M Sensitivity Margin
	 */

	public double cumulativeLIBOR1MSensitivityMargin()
	{
<span class="nc" id="L245">		double cumulativeLIBOR1MSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L248" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L250">			cumulativeLIBOR1MSensitivityMargin = cumulativeLIBOR1MSensitivityMargin +</span>
<span class="nc" id="L251">				libor1MSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L252">		}</span>

<span class="nc" id="L254">		return cumulativeLIBOR1MSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative LIBOR3M Sensitivity Margin
	 * 
	 * @return The Cumulative LIBOR3M Sensitivity Margin
	 */

	public double cumulativeLIBOR3MSensitivityMargin()
	{
<span class="nc" id="L265">		double cumulativeLIBOR3MSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L268" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L270">			cumulativeLIBOR3MSensitivityMargin = cumulativeLIBOR3MSensitivityMargin +</span>
<span class="nc" id="L271">				libor3MSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L272">		}</span>

<span class="nc" id="L274">		return cumulativeLIBOR3MSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative LIBOR6M Sensitivity Margin
	 * 
	 * @return The Cumulative LIBOR6M Sensitivity Margin
	 */

	public double cumulativeLIBOR6MSensitivityMargin()
	{
<span class="nc" id="L285">		double cumulativeLIBOR6MSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L288" title="All 2 branches missed.">			_libor6MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L290">			cumulativeLIBOR6MSensitivityMargin = cumulativeLIBOR6MSensitivityMargin +</span>
<span class="nc" id="L291">				libor6MSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L292">		}</span>

<span class="nc" id="L294">		return cumulativeLIBOR6MSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative LIBOR12M Sensitivity Margin
	 * 
	 * @return The Cumulative LIBOR12M Sensitivity Margin
	 */

	public double cumulativeLIBOR12MSensitivityMargin()
	{
<span class="nc" id="L305">		double cumulativeLIBOR12MSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L308" title="All 2 branches missed.">			_libor12MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L310">			cumulativeLIBOR12MSensitivityMargin = cumulativeLIBOR12MSensitivityMargin +</span>
<span class="nc" id="L311">				libor12MSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L312">		}</span>

<span class="nc" id="L314">		return cumulativeLIBOR12MSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative PRIME Sensitivity Margin
	 * 
	 * @return The Cumulative PRIME Sensitivity Margin
	 */

	public double cumulativePRIMESensitivityMargin()
	{
<span class="nc" id="L325">		double cumulativePRIMESensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L328" title="All 2 branches missed.">			_primeSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L330">			cumulativePRIMESensitivityMargin = cumulativePRIMESensitivityMargin +</span>
<span class="nc" id="L331">				primeSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L332">		}</span>

<span class="nc" id="L334">		return cumulativePRIMESensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative MUNICIPAL Sensitivity Margin
	 * 
	 * @return The Cumulative MUNICIPAL Sensitivity Margin
	 */

	public double cumulativeMUNICIPALSensitivityMargin()
	{
<span class="nc" id="L345">		double cumulativeMUNICIPALSensitivityMargin = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L348" title="All 2 branches missed.">			_municipalSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L350">			cumulativeMUNICIPALSensitivityMargin = cumulativeMUNICIPALSensitivityMargin +</span>
<span class="nc" id="L351">				municipalSensitivityMarginEntry.getValue();</span>
<span class="nc" id="L352">		}</span>

<span class="nc" id="L354">		return cumulativeMUNICIPALSensitivityMargin;</span>
	}

	/**
	 * Compute the Cumulative Sensitivity Margin
	 * 
	 * @return The Cumulative Sensitivity Margin
	 */

	public double cumulativeSensitivityMargin()
	{
<span class="nc" id="L365">		return cumulativeOISSensitivityMargin() +</span>
<span class="nc" id="L366">			cumulativeLIBOR1MSensitivityMargin() +</span>
<span class="nc" id="L367">			cumulativeLIBOR3MSensitivityMargin() +</span>
<span class="nc" id="L368">			cumulativeLIBOR6MSensitivityMargin() +</span>
<span class="nc" id="L369">			cumulativeLIBOR12MSensitivityMargin() +</span>
<span class="nc" id="L370">			cumulativePRIMESensitivityMargin() +</span>
<span class="nc" id="L371">			cumulativeMUNICIPALSensitivityMargin();</span>
	}

	/**
	 * Compute the OIS-OIS Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-OIS Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_OIS (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L388" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L390">			throw new java.lang.Exception (&quot;IRFactorAggregate::marginCovariance_OIS_OIS =&gt; Invalid Inputs&quot;);</span>
		}

<span class="nc" id="L393">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L394">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L396">		double marginCovariance_OIS_OIS = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginOuterEntry :
<span class="nc bnc" id="L399" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L401">			java.lang.String outerTenor = oisSensitivityMarginOuterEntry.getKey();</span>

<span class="nc" id="L403">			double outerSensitivityMargin = oisSensitivityMarginOuterEntry.getValue();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginInnerEntry :
<span class="nc bnc" id="L406" title="All 2 branches missed.">				_oisSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L408">				java.lang.String innerTenor = oisSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L410">				marginCovariance_OIS_OIS = marginCovariance_OIS_OIS + outerSensitivityMargin *</span>
<span class="nc" id="L411">					oisSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L417">			}</span>
<span class="nc" id="L418">		}</span>

<span class="nc" id="L420">		return marginCovariance_OIS_OIS;</span>
	}

	/**
	 * Compute the LIBOR1M-LIBOR1M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-LIBOR1M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_LIBOR1M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L437" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L439">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_LIBOR1M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L443">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L444">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L446">		double marginCovariance_LIBOR1M_LIBOR1M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginOuterEntry :
<span class="nc bnc" id="L449" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L451">			double outerSensitivityMargin = libor1MSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L453">			java.lang.String outerTenor = libor1MSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginInnerEntry :
<span class="nc bnc" id="L456" title="All 2 branches missed.">				_libor1MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L458">				java.lang.String innerTenor = libor1MSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L460">				marginCovariance_LIBOR1M_LIBOR1M = marginCovariance_LIBOR1M_LIBOR1M + outerSensitivityMargin</span>
<span class="nc" id="L461">					* libor1MSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L467">			}</span>
<span class="nc" id="L468">		}</span>

<span class="nc" id="L470">		return marginCovariance_LIBOR1M_LIBOR1M;</span>
	}

	/**
	 * Compute the LIBOR3M-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR3M-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR3M_LIBOR3M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L487" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L489">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR3M_LIBOR3M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L493">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L494">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L496">		double marginCovariance_LIBOR3M_LIBOR3M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginOuterEntry :
<span class="nc bnc" id="L499" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L501">			double outerSensitivityMargin = libor3MSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L503">			java.lang.String outerTenor = libor3MSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginInnerEntry :
<span class="nc bnc" id="L506" title="All 2 branches missed.">				_libor3MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L508">				java.lang.String innerTenor = libor3MSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L510">				marginCovariance_LIBOR3M_LIBOR3M = marginCovariance_LIBOR3M_LIBOR3M +</span>
<span class="nc" id="L511">					outerSensitivityMargin * libor3MSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L517">			}</span>
<span class="nc" id="L518">		}</span>

<span class="nc" id="L520">		return marginCovariance_LIBOR3M_LIBOR3M;</span>
	}

	/**
	 * Compute the LIBOR6M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR6M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR6M_LIBOR6M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L537" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L539">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR6M_LIBOR6M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L543">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L544">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L546">		double marginCovariance_LIBOR6M_LIBOR6M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginOuterEntry :
<span class="nc bnc" id="L549" title="All 2 branches missed.">			_libor6MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L551">			double outerSensitivityMargin = libor6MSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L553">			java.lang.String outerTenor = libor6MSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginInnerEntry :
<span class="nc bnc" id="L556" title="All 2 branches missed.">				_libor6MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L558">				java.lang.String innerTenor = libor6MSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L560">				marginCovariance_LIBOR6M_LIBOR6M = marginCovariance_LIBOR6M_LIBOR6M +</span>
<span class="nc" id="L561">					outerSensitivityMargin * libor6MSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L567">			}</span>
<span class="nc" id="L568">		}</span>

<span class="nc" id="L570">		return marginCovariance_LIBOR6M_LIBOR6M;</span>
	}

	/**
	 * Compute the LIBOR12M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR12M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR12M_LIBOR12M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L587" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L589">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR12M_LIBOR12M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L593">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L594">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L596">		double marginCovariance_LIBOR12M_LIBOR12M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginOuterEntry :
<span class="nc bnc" id="L599" title="All 2 branches missed.">			_libor12MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L601">			double outerSensitivityMargin = libor12MSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L603">			java.lang.String outerTenor = libor12MSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginInnerEntry
<span class="nc bnc" id="L606" title="All 2 branches missed.">				: _libor12MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L608">				java.lang.String innerTenor = libor12MSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L610">				marginCovariance_LIBOR12M_LIBOR12M = marginCovariance_LIBOR12M_LIBOR12M +</span>
<span class="nc" id="L611">					outerSensitivityMargin * libor12MSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L617">			}</span>
<span class="nc" id="L618">		}</span>

<span class="nc" id="L620">		return marginCovariance_LIBOR12M_LIBOR12M;</span>
	}

	/**
	 * Compute the PRIME-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The PRIME-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_PRIME_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L637" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L639">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_PRIME_PRIME =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L643">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L644">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L646">		double marginCovariance_PRIME_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginOuterEntry :
<span class="nc bnc" id="L649" title="All 2 branches missed.">			_primeSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L651">			double outerSensitivityMargin = primeSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L653">			java.lang.String outerTenor = primeSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginInnerEntry :
<span class="nc bnc" id="L656" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L658">				java.lang.String innerTenor = primeSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L660">				marginCovariance_PRIME_PRIME = marginCovariance_PRIME_PRIME + outerSensitivityMargin *</span>
<span class="nc" id="L661">					primeSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L667">			}</span>
<span class="nc" id="L668">		}</span>

<span class="nc" id="L670">		return marginCovariance_PRIME_PRIME;</span>
	}

	/**
	 * Compute the MUNICIPAL-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The MUNICIPAL-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_MUNICIPAL_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L687" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L689">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_MUNICIPAL_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L693">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L694">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L696">		double marginCovariance_MUNICIPAL_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginOuterEntry :
<span class="nc bnc" id="L699" title="All 2 branches missed.">			_municipalSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L701">			double outerSensitivityMargin = municipalSensitivityMarginOuterEntry.getValue();</span>

<span class="nc" id="L703">			java.lang.String outerTenor = municipalSensitivityMarginOuterEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginInnerEntry
<span class="nc bnc" id="L706" title="All 2 branches missed.">				: _municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L708">				java.lang.String innerTenor = municipalSensitivityMarginInnerEntry.getKey();</span>

<span class="nc" id="L710">				marginCovariance_MUNICIPAL_MUNICIPAL = marginCovariance_MUNICIPAL_MUNICIPAL +</span>
<span class="nc" id="L711">					outerSensitivityMargin * municipalSensitivityMarginInnerEntry.getValue() * (</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">						outerTenor.equalsIgnoreCase (innerTenor) ? 1. : tenorCorrelation.entry (</span>
							outerTenor,
							innerTenor
						)
					);
<span class="nc" id="L717">			}</span>
<span class="nc" id="L718">		}</span>

<span class="nc" id="L720">		return marginCovariance_MUNICIPAL_MUNICIPAL;</span>
	}

	/**
	 * Compute the OIS-LIBOR1M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-LIBOR1M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_LIBOR1M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L737" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L739">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_LIBOR1M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L743">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L744">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L746">		double marginCovariance_OIS_LIBOR1M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L749" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L751">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L753">			double oisSensitivityMargin = oisSensitivityMarginEntry.getValue();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L756" title="All 2 branches missed.">				_libor1MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L758">				java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L760">				marginCovariance_OIS_LIBOR1M = marginCovariance_OIS_LIBOR1M + oisSensitivityMargin *</span>
<span class="nc" id="L761">					libor1MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (libor1MTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							libor1MTenor
						)
					);
<span class="nc" id="L767">			}</span>
<span class="nc" id="L768">		}</span>

<span class="nc" id="L770">		return marginCovariance_OIS_LIBOR1M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the OIS-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_LIBOR3M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L787" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L789">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_LIBOR3M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L793">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L794">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L796">		double marginCovariance_OIS_LIBOR3M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L799" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L801">			double oisSensitivityMargin = oisSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L803">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L806" title="All 2 branches missed.">				_libor3MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L808">				java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L810">				marginCovariance_OIS_LIBOR3M = marginCovariance_OIS_LIBOR3M + oisSensitivityMargin *</span>
<span class="nc" id="L811">					libor3MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (libor3MTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							libor3MTenor
						)
					);
<span class="nc" id="L817">			}</span>
<span class="nc" id="L818">		}</span>

<span class="nc" id="L820">		return marginCovariance_OIS_LIBOR3M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the OIS-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_LIBOR6M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L837" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L839">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_LIBOR6M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L843">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L844">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L846">		double marginCovariance_OIS_LIBOR6M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L849" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L851">			double oisSensitivityMargin = oisSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L853">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L856" title="All 2 branches missed.">				_libor6MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L858">				java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L860">				marginCovariance_OIS_LIBOR6M = marginCovariance_OIS_LIBOR6M + oisSensitivityMargin *</span>
<span class="nc" id="L861">					libor6MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (libor6MTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							libor6MTenor
						)
					);
<span class="nc" id="L867">			}</span>
<span class="nc" id="L868">		}</span>

<span class="nc" id="L870">		return marginCovariance_OIS_LIBOR6M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the OIS-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_LIBOR12M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L887" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L889">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_LIBOR12M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L893">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L894">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L896">		double marginCovariance_OIS_LIBOR12M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L899" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L901">			double oisSensitivity = oisSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L903">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L906" title="All 2 branches missed.">				_libor12MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L908">				java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L910">				marginCovariance_OIS_LIBOR12M = marginCovariance_OIS_LIBOR12M +</span>
<span class="nc" id="L911">					oisSensitivity * libor12MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (libor12MTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							libor12MTenor
						)
					);
<span class="nc" id="L917">			}</span>
<span class="nc" id="L918">		}</span>

<span class="nc" id="L920">		return marginCovariance_OIS_LIBOR12M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the OIS-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L937" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L939">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_PRIME =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L943">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L944">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L946">		double marginCovariance_OIS_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L949" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L951">			double oisSensitivityMargin = oisSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L953">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L956" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L958">				java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L960">				marginCovariance_OIS_PRIME = marginCovariance_OIS_PRIME + oisSensitivityMargin *</span>
<span class="nc" id="L961">					primeSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (primeTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							primeTenor
						)
					);
<span class="nc" id="L967">			}</span>
<span class="nc" id="L968">		}</span>

<span class="nc" id="L970">		return marginCovariance_OIS_PRIME * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the OIS-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The OIS-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_OIS_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L987" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L989">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_OIS_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L993">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L994">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L996">		double marginCovariance_OIS_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; oisSensitivityMarginEntry :
<span class="nc bnc" id="L999" title="All 2 branches missed.">			_oisSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1001">			double oisSensitivityMargin = oisSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1003">			java.lang.String oisTenor = oisSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1006" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1008">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1010">				marginCovariance_OIS_MUNICIPAL = marginCovariance_OIS_MUNICIPAL +</span>
<span class="nc" id="L1011">					oisSensitivityMargin * municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">						oisTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							oisTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1017">			}</span>
<span class="nc" id="L1018">		}</span>

<span class="nc" id="L1020">		return marginCovariance_OIS_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR1M-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-LIBOR3M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_LIBOR3M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1037" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1039">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_LIBOR3M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1043">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1044">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1046">		double marginCovariance_LIBOR1M_LIBOR3M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L1049" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1051">			double libor1MSensitivityMargin = libor1MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1053">			java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L1056" title="All 2 branches missed.">				_libor3MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1058">				java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1060">				marginCovariance_LIBOR1M_LIBOR3M = marginCovariance_LIBOR1M_LIBOR3M +</span>
<span class="nc" id="L1061">					libor1MSensitivityMargin * libor3MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">						libor1MTenor.equalsIgnoreCase (libor3MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor1MTenor,
							libor3MTenor
						)
					);
<span class="nc" id="L1067">			}</span>
<span class="nc" id="L1068">		}</span>

<span class="nc" id="L1070">		return marginCovariance_LIBOR1M_LIBOR3M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR1M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_LIBOR6M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1087" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1089">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_LIBOR6M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1093">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1094">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1096">		double marginCovariance_LIBOR1M_LIBOR6M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L1099" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1101">			double libor1MSensitivityMargin = libor1MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1103">			java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L1106" title="All 2 branches missed.">				_libor6MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1108">				java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1110">				marginCovariance_LIBOR1M_LIBOR6M = marginCovariance_LIBOR1M_LIBOR6M +</span>
<span class="nc" id="L1111">					libor1MSensitivityMargin * libor6MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1112" title="All 2 branches missed.">						libor1MTenor.equalsIgnoreCase (libor6MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor1MTenor,
							libor6MTenor
						)
					);
<span class="nc" id="L1117">			}</span>
<span class="nc" id="L1118">		}</span>

<span class="nc" id="L1120">		return marginCovariance_LIBOR1M_LIBOR6M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR1M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_LIBOR12M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1137" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1139">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_LIBOR12M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1143">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1144">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1146">		double marginCovariance_LIBOR1M_LIBOR12M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L1149" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1151">			double libor1MSensitivityMargin = libor1MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1153">			java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L1156" title="All 2 branches missed.">				_libor12MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1158">				java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1160">				marginCovariance_LIBOR1M_LIBOR12M = marginCovariance_LIBOR1M_LIBOR12M +</span>
<span class="nc" id="L1161">					libor1MSensitivityMargin * libor12MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">						libor1MTenor.equalsIgnoreCase (libor12MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor1MTenor,
							libor12MTenor
						)
					);
<span class="nc" id="L1167">			}</span>
<span class="nc" id="L1168">		}</span>

<span class="nc" id="L1170">		return marginCovariance_LIBOR1M_LIBOR12M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR1M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1187" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1189">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_PRIME =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1193">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1194">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1196">		double marginCovariance_LIBOR1M_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L1199" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1201">			double libor1MSensitivityMargin = libor1MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1203">			java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L1206" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1208">				java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1210">				marginCovariance_LIBOR1M_PRIME = marginCovariance_LIBOR1M_PRIME + libor1MSensitivityMargin *</span>
<span class="nc" id="L1211">					primeSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1212" title="All 2 branches missed.">						libor1MTenor.equalsIgnoreCase (primeTenor) ? 1. : tenorCorrelation.entry (</span>
							libor1MTenor,
							primeTenor
						)
					);
<span class="nc" id="L1217">			}</span>
<span class="nc" id="L1218">		}</span>

<span class="nc" id="L1220">		return marginCovariance_LIBOR1M_PRIME * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR1M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR1M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR1M_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1237" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1239">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR1M_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1243">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1244">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1246">		double marginCovariance_LIBOR1M_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor1MSensitivityMarginEntry :
<span class="nc bnc" id="L1249" title="All 2 branches missed.">			_libor1MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1251">			double libor1MSensitivityMargin = libor1MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1253">			java.lang.String libor1MTenor = libor1MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1256" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1258">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1260">				marginCovariance_LIBOR1M_MUNICIPAL = marginCovariance_LIBOR1M_MUNICIPAL +</span>
<span class="nc" id="L1261">					libor1MSensitivityMargin * municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1262" title="All 2 branches missed.">						libor1MTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							libor1MTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1267">			}</span>
<span class="nc" id="L1268">		}</span>

<span class="nc" id="L1270">		return marginCovariance_LIBOR1M_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR3M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR3M-LIBOR6M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR3M_LIBOR6M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1287" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1289">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR3M_LIBOR6M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1293">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1294">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1296">		double marginCovariance_LIBOR3M_LIBOR6M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L1299" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1301">			double libor3MSensitivityMargin = libor3MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1303">			java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L1306" title="All 2 branches missed.">				_libor6MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1308">				java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1310">				marginCovariance_LIBOR3M_LIBOR6M = marginCovariance_LIBOR3M_LIBOR6M +</span>
<span class="nc" id="L1311">					libor3MSensitivityMargin * libor6MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1312" title="All 2 branches missed.">						libor3MTenor.equalsIgnoreCase (libor6MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor3MTenor,
							libor6MTenor
						)
					);
<span class="nc" id="L1317">			}</span>
<span class="nc" id="L1318">		}</span>

<span class="nc" id="L1320">		return marginCovariance_LIBOR3M_LIBOR6M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR3M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR3M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR3M_LIBOR12M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1337" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1339">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR3M_LIBOR12M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1343">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1344">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1346">		double marginCovariance_LIBOR3M_LIBOR12M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L1349" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1351">			double libor3MSensitivityMargin = libor3MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1353">			java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L1356" title="All 2 branches missed.">				_libor12MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1358">				java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1360">				marginCovariance_LIBOR3M_LIBOR12M = marginCovariance_LIBOR3M_LIBOR12M +</span>
<span class="nc" id="L1361">					libor3MSensitivityMargin * libor12MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1362" title="All 2 branches missed.">						libor3MTenor.equalsIgnoreCase (libor12MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor3MTenor,
							libor12MTenor
						)
					);
<span class="nc" id="L1367">			}</span>
<span class="nc" id="L1368">		}</span>

<span class="nc" id="L1370">		return marginCovariance_LIBOR3M_LIBOR12M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR3M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR3M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR3M_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1387" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1389">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR3M_PRIME =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1393">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1394">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1396">		double marginCovariance_LIBOR3M_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L1399" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1401">			double libor3MSensitivityMargin = libor3MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1403">			java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L1406" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1408">				java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1410">				marginCovariance_LIBOR3M_PRIME = marginCovariance_LIBOR3M_PRIME + libor3MSensitivityMargin *</span>
<span class="nc" id="L1411">					primeSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1412" title="All 2 branches missed.">						libor3MTenor.equalsIgnoreCase (primeTenor) ? 1. : tenorCorrelation.entry (</span>
							libor3MTenor,
							primeTenor
						)
					);
<span class="nc" id="L1417">			}</span>
<span class="nc" id="L1418">		}</span>

<span class="nc" id="L1420">		return marginCovariance_LIBOR3M_PRIME * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR3M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR3M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR3M_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1437" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1439">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR3M_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1443">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1444">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1446">		double marginCovariance_LIBOR3M_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor3MSensitivityMarginEntry :
<span class="nc bnc" id="L1449" title="All 2 branches missed.">			_libor3MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1451">			double libor3MSensitivityMargin = libor3MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1453">			java.lang.String libor3MTenor = libor3MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1456" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1458">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1460">				marginCovariance_LIBOR3M_MUNICIPAL = marginCovariance_LIBOR3M_MUNICIPAL +</span>
<span class="nc" id="L1461">					libor3MSensitivityMargin * municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1462" title="All 2 branches missed.">						libor3MTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							libor3MTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1467">			}</span>
<span class="nc" id="L1468">		}</span>

<span class="nc" id="L1470">		return marginCovariance_LIBOR3M_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR6M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR6M-LIBOR12M Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR6M_LIBOR12M (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1487" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1489">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR6M_LIBOR12M =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1493">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1494">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1496">		double marginCovariance_LIBOR6M_LIBOR12M = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L1499" title="All 2 branches missed.">			_libor6MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1501">			double libor6MSensitivityMargin = libor6MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1503">			java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L1506" title="All 2 branches missed.">				_libor12MSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1508">				java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1510">				marginCovariance_LIBOR6M_LIBOR12M = marginCovariance_LIBOR6M_LIBOR12M +</span>
<span class="nc" id="L1511">					libor6MSensitivityMargin * libor12MSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1512" title="All 2 branches missed.">						libor6MTenor.equalsIgnoreCase (libor12MTenor) ? 1. : tenorCorrelation.entry (</span>
							libor6MTenor,
							libor12MTenor
						)
					);
<span class="nc" id="L1517">			}</span>
<span class="nc" id="L1518">		}</span>

<span class="nc" id="L1520">		return marginCovariance_LIBOR6M_LIBOR12M * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR6M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR6M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR6M_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1537" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1539">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR6M_PRIME =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1543">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1544">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1546">		double marginCovariance_LIBOR6M_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L1549" title="All 2 branches missed.">			_libor6MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1551">			double libor6MSensitivityMargin = libor6MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1553">			java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L1556" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1558">				java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1560">				marginCovariance_LIBOR6M_PRIME = marginCovariance_LIBOR6M_PRIME + libor6MSensitivityMargin *</span>
<span class="nc" id="L1561">					primeSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1562" title="All 2 branches missed.">						libor6MTenor.equalsIgnoreCase (primeTenor) ? 1. : tenorCorrelation.entry (</span>
							libor6MTenor,
							primeTenor
						)
					);
<span class="nc" id="L1567">			}</span>
<span class="nc" id="L1568">		}</span>

<span class="nc" id="L1570">		return marginCovariance_LIBOR6M_PRIME * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR6M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR6M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR6M_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1587" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1589">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR6M_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1593">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1594">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1596">		double marginCovariance_LIBOR6M_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor6MSensitivityMarginEntry :
<span class="nc bnc" id="L1599" title="All 2 branches missed.">			_libor6MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1601">			double libor6MSensitivityMargin = libor6MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1603">			java.lang.String libor6MTenor = libor6MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1606" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1608">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1610">				marginCovariance_LIBOR6M_MUNICIPAL = marginCovariance_LIBOR6M_MUNICIPAL +</span>
<span class="nc" id="L1611">					libor6MSensitivityMargin * municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1612" title="All 2 branches missed.">						libor6MTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							libor6MTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1617">			}</span>
<span class="nc" id="L1618">		}</span>

<span class="nc" id="L1620">		return marginCovariance_LIBOR6M_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR12M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR12M-PRIME Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR12M_PRIME (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1637" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1639">			throw new java.lang.Exception (&quot;IRFactorAggregate::covariance_LIBOR12M_PRIME =&gt; Invalid Inputs&quot;);</span>
		}

<span class="nc" id="L1642">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1643">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1645">		double marginCovariance_LIBOR12M_PRIME = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L1648" title="All 2 branches missed.">			_libor12MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1650">			double libor12MSensitivityMargin = libor12MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1652">			java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L1655" title="All 2 branches missed.">				_primeSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1657">				java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1659">				marginCovariance_LIBOR12M_PRIME = marginCovariance_LIBOR12M_PRIME + libor12MSensitivityMargin *</span>
<span class="nc" id="L1660">					primeSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">						libor12MTenor.equalsIgnoreCase (primeTenor) ? 1. : tenorCorrelation.entry (</span>
							libor12MTenor,
							primeTenor
						)
					);
<span class="nc" id="L1666">			}</span>
<span class="nc" id="L1667">		}</span>

<span class="nc" id="L1669">		return marginCovariance_LIBOR12M_PRIME * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the LIBOR12M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The LIBOR12M-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_LIBOR12M_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1686" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1688">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_LIBOR12M_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1692">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1693">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1695">		double marginCovariance_LIBOR12M_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; libor12MSensitivityMarginEntry :
<span class="nc bnc" id="L1698" title="All 2 branches missed.">			_libor12MSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1700">			double libor12MSensitivityMargin = libor12MSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1702">			java.lang.String libor12MTenor = libor12MSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1705" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1707">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1709">				marginCovariance_LIBOR12M_MUNICIPAL = marginCovariance_LIBOR12M_MUNICIPAL +</span>
<span class="nc" id="L1710">					libor12MSensitivityMargin * municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">						libor12MTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							libor12MTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1716">			}</span>
<span class="nc" id="L1717">		}</span>

<span class="nc" id="L1719">		return marginCovariance_LIBOR12M_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the PRIME-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The PRIME-MUNICIPAL Sensitivity Margin Co-variance
	 * 
	 * @throws java.lang.Exception Thrown if the Inputs are Invalid
	 */

	public double marginCovariance_PRIME_MUNICIPAL (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
		throws java.lang.Exception
	{
<span class="nc bnc" id="L1736" title="All 2 branches missed.">		if (null == bucketSensitivitySettingsIR)</span>
		{
<span class="nc" id="L1738">			throw new java.lang.Exception</span>
				(&quot;IRFactorAggregate::marginCovariance_PRIME_MUNICIPAL =&gt; Invalid Inputs&quot;);
		}

<span class="nc" id="L1742">		org.drip.measure.stochastic.LabelCorrelation tenorCorrelation =</span>
<span class="nc" id="L1743">			bucketSensitivitySettingsIR.crossTenorCorrelation();</span>

<span class="nc" id="L1745">		double marginCovariance_PRIME_MUNICIPAL = 0.;</span>

		for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; primeSensitivityMarginEntry :
<span class="nc bnc" id="L1748" title="All 2 branches missed.">			_primeSensitivityMargin.entrySet())</span>
		{
<span class="nc" id="L1750">			double primeSensitivityMargin = primeSensitivityMarginEntry.getValue();</span>

<span class="nc" id="L1752">			java.lang.String primeTenor = primeSensitivityMarginEntry.getKey();</span>

			for (java.util.Map.Entry&lt;java.lang.String, java.lang.Double&gt; municipalSensitivityMarginEntry :
<span class="nc bnc" id="L1755" title="All 2 branches missed.">				_municipalSensitivityMargin.entrySet())</span>
			{
<span class="nc" id="L1757">				java.lang.String municipalTenor = municipalSensitivityMarginEntry.getKey();</span>

<span class="nc" id="L1759">				marginCovariance_PRIME_MUNICIPAL = marginCovariance_PRIME_MUNICIPAL + primeSensitivityMargin *</span>
<span class="nc" id="L1760">					municipalSensitivityMarginEntry.getValue() * (</span>
<span class="nc bnc" id="L1761" title="All 2 branches missed.">						primeTenor.equalsIgnoreCase (municipalTenor) ? 1. : tenorCorrelation.entry (</span>
							primeTenor,
							municipalTenor
						)
					);
<span class="nc" id="L1766">			}</span>
<span class="nc" id="L1767">		}</span>

<span class="nc" id="L1769">		return marginCovariance_PRIME_MUNICIPAL * bucketSensitivitySettingsIR.crossCurveCorrelation();</span>
	}

	/**
	 * Compute the Complete Net Sensitivity Margin Co-variance
	 * 
	 * @param bucketSensitivitySettingsIR The IR Currency Bucket Curve Tenor Sensitivity Settings
	 * 
	 * @return The Complete Net Sensitivity Margin Co-variance
	 */

	public org.drip.simm20.margin.IRSensitivityAggregate margin (
		final org.drip.simm20.parameters.BucketSensitivitySettingsIR bucketSensitivitySettingsIR)
	{
		try
		{
<span class="nc" id="L1785">			return new org.drip.simm20.margin.IRSensitivityAggregate (</span>
<span class="nc" id="L1786">				marginCovariance_OIS_OIS (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1787">				marginCovariance_OIS_LIBOR1M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1788">				marginCovariance_OIS_LIBOR3M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1789">				marginCovariance_OIS_LIBOR6M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1790">				marginCovariance_OIS_LIBOR12M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1791">				marginCovariance_OIS_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1792">				marginCovariance_OIS_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1793">				marginCovariance_LIBOR1M_LIBOR1M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1794">				marginCovariance_LIBOR1M_LIBOR3M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1795">				marginCovariance_LIBOR1M_LIBOR6M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1796">				marginCovariance_LIBOR1M_LIBOR12M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1797">				marginCovariance_LIBOR1M_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1798">				marginCovariance_LIBOR1M_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1799">				marginCovariance_LIBOR3M_LIBOR3M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1800">				marginCovariance_LIBOR3M_LIBOR6M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1801">				marginCovariance_LIBOR3M_LIBOR12M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1802">				marginCovariance_LIBOR3M_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1803">				marginCovariance_LIBOR3M_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1804">				marginCovariance_LIBOR6M_LIBOR6M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1805">				marginCovariance_LIBOR6M_LIBOR12M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1806">				marginCovariance_LIBOR6M_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1807">				marginCovariance_LIBOR6M_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1808">				marginCovariance_LIBOR12M_LIBOR12M (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1809">				marginCovariance_LIBOR12M_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1810">				marginCovariance_LIBOR12M_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1811">				marginCovariance_PRIME_PRIME (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1812">				marginCovariance_PRIME_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1813">				marginCovariance_MUNICIPAL_MUNICIPAL (bucketSensitivitySettingsIR),</span>
<span class="nc" id="L1814">				cumulativeSensitivityMargin()</span>
			);
		}
<span class="nc" id="L1817">		catch (java.lang.Exception e)</span>
		{
<span class="nc" id="L1819">			e.printStackTrace();</span>
		}

<span class="nc" id="L1822">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>