<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BondProductBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DROP</a> &gt; <a href="index.source.html" class="el_package">org.drip.product.creator</a> &gt; <span class="el_source">BondProductBuilder.java</span></div><h1>BondProductBuilder.java</h1><pre class="source lang-java linenums">
package org.drip.product.creator;

/*
 * -*- mode: java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 */

/*!
 * Copyright (C) 2018 Lakshmi Krishnamurthy
 * Copyright (C) 2017 Lakshmi Krishnamurthy
 * Copyright (C) 2016 Lakshmi Krishnamurthy
 * Copyright (C) 2015 Lakshmi Krishnamurthy
 * Copyright (C) 2014 Lakshmi Krishnamurthy
 * Copyright (C) 2013 Lakshmi Krishnamurthy
 * Copyright (C) 2012 Lakshmi Krishnamurthy
 * Copyright (C) 2011 Lakshmi Krishnamurthy
 * 
 *  This file is part of DRIP, a free-software/open-source library for buy/side financial/trading model
 *  	libraries targeting analysts and developers
 *  	https://lakshmidrip.github.io/DRIP/
 *  
 *  DRIP is composed of four main libraries:
 *  
 *  - DRIP Fixed Income - https://lakshmidrip.github.io/DRIP-Fixed-Income/
 *  - DRIP Asset Allocation - https://lakshmidrip.github.io/DRIP-Asset-Allocation/
 *  - DRIP Numerical Optimizer - https://lakshmidrip.github.io/DRIP-Numerical-Optimizer/
 *  - DRIP Statistical Learning - https://lakshmidrip.github.io/DRIP-Statistical-Learning/
 * 
 *  - DRIP Fixed Income: Library for Instrument/Trading Conventions, Treasury Futures/Options,
 *  	Funding/Forward/Overnight Curves, Multi-Curve Construction/Valuation, Collateral Valuation and XVA
 *  	Metric Generation, Calibration and Hedge Attributions, Statistical Curve Construction, Bond RV
 *  	Metrics, Stochastic Evolution and Option Pricing, Interest Rate Dynamics and Option Pricing, LMM
 *  	Extensions/Calibrations/Greeks, Algorithmic Differentiation, and Asset Backed Models and Analytics.
 * 
 *  - DRIP Asset Allocation: Library for model libraries for MPT framework, Black Litterman Strategy
 *  	Incorporator, Holdings Constraint, and Transaction Costs.
 * 
 *  - DRIP Numerical Optimizer: Library for Numerical Optimization and Spline Functionality.
 * 
 *  - DRIP Statistical Learning: Library for Statistical Evaluation and Machine Learning.
 * 
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   	you may not use this file except in compliance with the License.
 *   
 *  You may obtain a copy of the License at
 *  	http://www.apache.org/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  	distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  See the License for the specific language governing permissions and
 *  	limitations under the License.
 */

/**
 * BondProductBuilder holds the static parameters of the bond product needed for the full bond valuation. It
 * 		contains the bond identifier parameters (ISIN, CUSIP), the issuer level parameters (Ticker, SPN or
 * 		the credit curve string), coupon parameters (coupon rate, coupon frequency, coupon type, day count),
 * 		maturity parameters (maturity date, maturity type, final maturity, redemption value), date parameters
 * 		(announce, first settle, first coupon, interest accrual start, and issue dates), embedded option
 * 		parameters (callable, putable, has been exercised), currency parameters (trade, coupon, and
 * 		redemption currencies), floater parameters (floater flag, floating coupon convention, current coupon,
 * 		rate index, spread), and whether the bond is perpetual or has defaulted.
 * 
 * @author Lakshmi Krishnamurthy
 *
 */

public class BondProductBuilder {
	private static final boolean m_bBlog = false;
	private static final boolean m_bDisplayWarnings = true;

	/**
	 * ISIN
	 */

<span class="nc" id="L78">	public java.lang.String _strISIN = &quot;&quot;;</span>

	/**
	 * CUSIP
	 */

<span class="nc" id="L84">	public java.lang.String _strCUSIP = &quot;&quot;;</span>

	/**
	 * Ticker
	 */

<span class="nc" id="L90">	public java.lang.String _strTicker = &quot;&quot;;</span>

	/**
	 * Coupon
	 */

<span class="nc" id="L96">	public double _dblCoupon = java.lang.Double.NaN;</span>

	/**
	 * Maturity
	 */

<span class="nc" id="L102">	public org.drip.analytics.date.JulianDate _dtMaturity = null;</span>

	/**
	 * Coupon Frequency
	 */

<span class="nc" id="L108">	public int _iCouponFreq = 0;</span>

	/**
	 * Coupon Type
	 */

<span class="nc" id="L114">	public java.lang.String _strCouponType = &quot;&quot;;</span>

	/**
	 * Maturity Type
	 */

<span class="nc" id="L120">	public java.lang.String _strMaturityType = &quot;&quot;;</span>

	/**
	 * Calculation Type
	 */

<span class="nc" id="L126">	public java.lang.String _strCalculationType = &quot;&quot;;</span>

	/**
	 * Day count Code
	 */

<span class="nc" id="L132">	public java.lang.String _strDayCountCode = &quot;&quot;;</span>

	/**
	 * Redemption Value
	 */

<span class="nc" id="L138">	public double _dblRedemptionValue = java.lang.Double.NaN;</span>

	/**
	 * Announce Date
	 */

<span class="nc" id="L144">	public org.drip.analytics.date.JulianDate _dtAnnounce = null;</span>

	/**
	 * First Settle Date
	 */

<span class="nc" id="L150">	public org.drip.analytics.date.JulianDate _dtFirstSettle = null;</span>

	/**
	 * First Coupon Date
	 */

<span class="nc" id="L156">	public org.drip.analytics.date.JulianDate _dtFirstCoupon = null;</span>

	/**
	 * Interest Accrual Start Date
	 */

<span class="nc" id="L162">	public org.drip.analytics.date.JulianDate _dtInterestAccrualStart = null;</span>

	/**
	 * Issue Date
	 */

<span class="nc" id="L168">	public org.drip.analytics.date.JulianDate _dtIssue = null;</span>

	/**
	 * Callable flag
	 */

<span class="nc" id="L174">	public boolean _bIsCallable = false;</span>

	/**
	 * Putable flag
	 */

<span class="nc" id="L180">	public boolean _bIsPutable = false;</span>

	/**
	 * Sinkable flag
	 */

<span class="nc" id="L186">	public boolean _bIsSinkable = false;</span>

	/**
	 * Redemption Currency
	 */

<span class="nc" id="L192">	public java.lang.String _strRedemptionCurrency = &quot;&quot;;</span>

	/**
	 * Coupon Currency
	 */

<span class="nc" id="L198">	public java.lang.String _strCouponCurrency = &quot;&quot;;</span>

	/**
	 * Trade Currency
	 */

<span class="nc" id="L204">	public java.lang.String _strTradeCurrency = &quot;&quot;;</span>

	/**
	 * Has Been Exercised flag
	 */

<span class="nc" id="L210">	public boolean _bHasBeenCalled = false;</span>

	/**
	 * Floater Coupon Day Count Convention
	 */

<span class="nc" id="L216">	public java.lang.String _strFloatCouponConvention = &quot;&quot;;</span>

	/**
	 * Current Coupon
	 */

<span class="nc" id="L222">	public double _dblCurrentCoupon = java.lang.Double.NaN;</span>

	/**
	 * Is Floater flag
	 */

<span class="nc" id="L228">	public boolean _bIsFloater = false;</span>

	/**
	 * Final Maturity Date
	 */

<span class="nc" id="L234">	public org.drip.analytics.date.JulianDate _dtFinalMaturity = null;</span>

	/**
	 * Is Perpetual flag
	 */

<span class="nc" id="L240">	public boolean _bIsPerpetual = false;</span>

	/**
	 * Is Defaulted flag
	 */

<span class="nc" id="L246">	public boolean _bIsDefaulted = false;</span>

	/**
	 * Floater Spread
	 */

<span class="nc" id="L252">	public double _dblFloatSpread = java.lang.Double.NaN;</span>

	/**
	 * Rate Index
	 */

<span class="nc" id="L258">	public java.lang.String _strRateIndex = &quot;&quot;;</span>

	/**
	 * Issuer SPN
	 */

<span class="nc" id="L264">	public java.lang.String _strIssuerSPN = &quot;&quot;;</span>

	private static final java.lang.String DES (
		final BondProductBuilder bpb)
	{
<span class="nc" id="L269">		return bpb._strTicker + &quot;  &quot; + bpb._dtMaturity.toString() + &quot;[&quot; + bpb._strISIN + &quot;]&quot;;</span>
	}

	private org.drip.analytics.date.JulianDate reconcileStartDate()
	{
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if (null != _dtInterestAccrualStart) return _dtInterestAccrualStart;</span>

<span class="nc bnc" id="L276" title="All 2 branches missed.">		if (null != _dtIssue) return _dtIssue;</span>

<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (null != _dtFirstSettle) return _dtFirstSettle;</span>

<span class="nc" id="L280">		return _dtAnnounce;</span>
	}

	/**
	 * Create BondProductBuilder from the SQL ResultSet and the input MPC
	 * 
	 * @param rs SQL ResultSet
	 * @param mpc org.drip.param.definition.MarketParams to help fill some of the fields in
	 * 
	 * @return BondProductBuilder object
	 */

	public static final BondProductBuilder CreateFromResultSet (
		final java.sql.ResultSet rs,
		final org.drip.param.definition.ScenarioMarketParams mpc)
	{
		try {
<span class="nc" id="L297">			BondProductBuilder bpb = new BondProductBuilder();</span>

<span class="nc bnc" id="L299" title="All 2 branches missed.">			if (null == (bpb._strISIN = rs.getString (&quot;ISIN&quot;))) {</span>
<span class="nc" id="L300">				System.out.println (&quot;No ISIN!&quot;);</span>

<span class="nc" id="L302">				return null;</span>
			}

			if (m_bBlog) System.out.println (&quot;Loading &quot; + bpb._strISIN + &quot; ...&quot;);

<span class="nc bnc" id="L307" title="All 2 branches missed.">			if (null == (bpb._strCUSIP = rs.getString (&quot;CUSIP&quot;))) {</span>
<span class="nc" id="L308">				System.out.println (&quot;No CUSIP!&quot;);</span>

<span class="nc" id="L310">				return null;</span>
			}

<span class="nc" id="L313">			bpb._strTicker = rs.getString (&quot;Ticker&quot;);</span>

<span class="nc bnc" id="L315" title="All 2 branches missed.">			if (!org.drip.quant.common.NumberUtil.IsValid (bpb._dblCoupon = 0.01 * rs.getDouble (&quot;Coupon&quot;)))</span>
			{
<span class="nc" id="L317">				System.out.println (&quot;Invalid coupon for ISIN &quot; + bpb._strISIN);</span>

<span class="nc" id="L319">				return null;</span>
			}

<span class="nc bnc" id="L322" title="All 2 branches missed.">			if (null == (bpb._dtMaturity = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry (rs.getDate</span>
<span class="nc" id="L323">				(&quot;Maturity&quot;)))) {</span>
<span class="nc" id="L324">				System.out.println (&quot;Invalid maturity for ISIN &quot; + bpb._strISIN);</span>

<span class="nc" id="L326">				return null;</span>
			}

<span class="nc" id="L329">			bpb._iCouponFreq = rs.getInt (&quot;CouponFreq&quot;);</span>

<span class="nc" id="L331">			bpb._strCouponType = rs.getString (&quot;CouponType&quot;);</span>

<span class="nc" id="L333">			bpb._strMaturityType = rs.getString (&quot;MaturityType&quot;);</span>

<span class="nc" id="L335">			bpb._strCalculationType = rs.getString (&quot;CalculationType&quot;);</span>

<span class="nc" id="L337">			bpb._strDayCountCode = rs.getString (&quot;DayCountConv&quot;);</span>

<span class="nc" id="L339">			bpb._dblRedemptionValue = rs.getDouble (&quot;RedemptionValue&quot;);</span>

<span class="nc bnc" id="L341" title="All 2 branches missed.">			if (null == (bpb._dtAnnounce = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry (rs.getDate</span>
<span class="nc" id="L342">				(&quot;AnnounceDate&quot;)))) {</span>
<span class="nc" id="L343">				System.out.println (&quot;Invalid announce date for ISIN &quot; + DES (bpb));</span>

<span class="nc" id="L345">				return null;</span>
			}

<span class="nc" id="L348">			if (null == (bpb._dtFirstSettle = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">				(rs.getDate (&quot;FirstSettleDate&quot;)))) {</span>
<span class="nc" id="L350">				System.out.println (&quot;Invalid first settle date for ISIN &quot; + DES (bpb));</span>

<span class="nc" id="L352">				return null;</span>
			}

<span class="nc" id="L355">			if (null == (bpb._dtFirstCoupon = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">				(rs.getDate (&quot;FirstCouponDate&quot;)))) {</span>
				if (m_bBlog) System.out.println (&quot;Invalid first coupon date for ISIN &quot; + DES (bpb));
			}

<span class="nc" id="L360">			if (null == (bpb._dtInterestAccrualStart = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">				(rs.getDate (&quot;AccrualStartDate&quot;)))) {</span>
<span class="nc" id="L362">				System.out.println (&quot;Invalid accrual start date for &quot; + DES (bpb));</span>

<span class="nc" id="L364">				return null;</span>
			}

<span class="nc bnc" id="L367" title="All 2 branches missed.">			if (null == (bpb._dtIssue = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry (rs.getDate</span>
<span class="nc" id="L368">				(&quot;IssueDate&quot;)))) {</span>
<span class="nc" id="L369">				System.out.println (&quot;Invalid issue date for &quot; + DES (bpb));</span>

<span class="nc" id="L371">				return null;</span>
			}

<span class="nc" id="L374">			bpb._bIsCallable = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L375">				(&quot;IsCallable&quot;));</span>

<span class="nc" id="L377">			bpb._bIsPutable = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L378">				(&quot;IsPutable&quot;));</span>

<span class="nc" id="L380">			bpb._bIsSinkable = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L381">				(&quot;IsSinkable&quot;));</span>

<span class="nc" id="L383">			bpb._strRedemptionCurrency = org.drip.analytics.support.Helper.SwitchIRCurve</span>
<span class="nc" id="L384">				(rs.getString (&quot;RedemptionCurrency&quot;));</span>

<span class="nc bnc" id="L386" title="All 4 branches missed.">			if (null == bpb._strRedemptionCurrency || bpb._strRedemptionCurrency.isEmpty()) {</span>
<span class="nc" id="L387">				System.out.println (&quot;Invalid redemption currency for &quot; + DES (bpb));</span>

<span class="nc" id="L389">				return null;</span>
			}

<span class="nc" id="L392">			bpb._strCouponCurrency = org.drip.analytics.support.Helper.SwitchIRCurve</span>
<span class="nc" id="L393">				(rs.getString (&quot;CouponCurrency&quot;));</span>

<span class="nc bnc" id="L395" title="All 4 branches missed.">			if (null == bpb._strCouponCurrency || bpb._strCouponCurrency.isEmpty()) {</span>
<span class="nc" id="L396">				System.out.println (&quot;Invalid coupon currency for &quot; + DES (bpb));</span>

<span class="nc" id="L398">				return null;</span>
			}

<span class="nc" id="L401">			bpb._strTradeCurrency = org.drip.analytics.support.Helper.SwitchIRCurve</span>
<span class="nc" id="L402">				(rs.getString (&quot;TradeCurrency&quot;));</span>

<span class="nc bnc" id="L404" title="All 4 branches missed.">			if (null == bpb._strTradeCurrency || bpb._strTradeCurrency.isEmpty()) {</span>
<span class="nc" id="L405">				System.out.println (&quot;Invalid trade currency for &quot; + DES (bpb));</span>

<span class="nc" id="L407">				return null;</span>
			}

<span class="nc" id="L410">			bpb._bHasBeenCalled = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L411">				(&quot;Called&quot;));</span>

<span class="nc" id="L413">			bpb._strFloatCouponConvention = rs.getString (&quot;FloatCouponConvention&quot;);</span>

<span class="nc" id="L415">			bpb._bIsFloater = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L416">				(&quot;Floater&quot;));</span>

			// bpb._dblCurrentCoupon = 0.01 * rs.getDouble (&quot;CurrentCoupon&quot;);

<span class="nc" id="L420">			bpb._dtFinalMaturity = org.drip.analytics.date.DateUtil.MakeJulianFromRSEntry (rs.getDate</span>
<span class="nc" id="L421">				(&quot;FinalMaturity&quot;));</span>

<span class="nc" id="L423">			bpb._bIsPerpetual = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L424">				(&quot;Perpetual&quot;));</span>

<span class="nc" id="L426">			bpb._bIsDefaulted = org.drip.quant.common.StringUtil.ParseFromUnitaryString (rs.getString</span>
<span class="nc" id="L427">				(&quot;Defaulted&quot;));</span>

<span class="nc" id="L429">			bpb._dblFloatSpread = 0.0001 * rs.getDouble (&quot;FloatSpread&quot;);</span>

<span class="nc" id="L431">			bpb._strRateIndex = rs.getString (&quot;RateIndex&quot;);</span>

<span class="nc bnc" id="L433" title="All 6 branches missed.">			if (bpb._bIsFloater &amp;&amp; !org.drip.quant.common.NumberUtil.IsValid (bpb._dblFloatSpread) &amp;&amp; (null ==</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">				bpb._strRateIndex || bpb._strRateIndex.isEmpty())) {</span>
<span class="nc" id="L435">				System.out.println (&quot;Invalid float spread for &quot; + DES (bpb));</span>

<span class="nc" id="L437">				return null;</span>
			}

<span class="nc" id="L440">			bpb._strIssuerSPN = rs.getString (&quot;SPN&quot;);</span>

<span class="nc bnc" id="L442" title="All 2 branches missed.">			if (!bpb.validate (mpc)) return null;</span>

			if (m_bBlog) System.out.println (&quot;Loaded &quot; + DES (bpb) + &quot;.&quot;);

<span class="nc" id="L446">			return bpb;</span>
<span class="nc" id="L447">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L448">			e.printStackTrace();</span>
		}

<span class="nc" id="L451">		return null;</span>
	}

	/**
	 * Create BondProductBuilder from the JSON Map and the input MPC
	 * 
	 * @param mapJSON The JSON Ref Data Map
	 * @param mpc org.drip.param.definition.MarketParams to help fill some of the fields in
	 * 
	 * @return BondProductBuilder object
	 */

	public static final BondProductBuilder CreateFromJSONMap (
		final org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.String&gt; mapJSON,
		final org.drip.param.definition.ScenarioMarketParams mpc)
	{
		/* if (null == mapJSON || 0 == mapJSON.size() || !mapJSON.containsKey (&quot;isin&quot;) || !mapJSON.containsKey
			(&quot;cusip&quot;) || !mapJSON.containsKey (&quot;ticker&quot;) || !mapJSON.containsKey (&quot;coupon&quot;) ||
				!mapJSON.containsKey (&quot;maturity&quot;) || !mapJSON.containsKey (&quot;frequency&quot;) ||
					!mapJSON.containsKey (&quot;couponType&quot;) || !mapJSON.containsKey (&quot;maturityType&quot;) ||
						!mapJSON.containsKey (&quot;calcType&quot;) || !mapJSON.containsKey (&quot;dayCount&quot;) ||
							!mapJSON.containsKey (&quot;redempValue&quot;) || !mapJSON.containsKey (&quot;redempCrncy&quot;) ||
								!mapJSON.containsKey (&quot;cpnCrncy&quot;) || !mapJSON.containsKey (&quot;tradeCrncy&quot;) ||
									!mapJSON.containsKey (&quot;firstCpnDate&quot;) || !mapJSON.containsKey
										(&quot;issueDate&quot;) || !mapJSON.containsKey (&quot;called&quot;) ||
											!mapJSON.containsKey (&quot;defaulted&quot;) || !mapJSON.containsKey
												(&quot;quotedMargin&quot;))
			return null; */

<span class="nc" id="L480">		BondProductBuilder bpb = new BondProductBuilder();</span>

<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (null == (bpb._strISIN = mapJSON.get (&quot;isin&quot;))) return null;</span>

<span class="nc bnc" id="L484" title="All 2 branches missed.">		if (null == (bpb._strCUSIP = mapJSON.get (&quot;cusip&quot;))) return null;</span>

<span class="nc bnc" id="L486" title="All 2 branches missed.">		if (null == (bpb._strTicker = mapJSON.get (&quot;ticker&quot;))) return null;</span>

<span class="nc bnc" id="L488" title="All 2 branches missed.">		if (!org.drip.quant.common.NumberUtil.IsValid (bpb._dblCoupon = 0.01 * java.lang.Double.parseDouble</span>
<span class="nc" id="L489">			(mapJSON.get (&quot;coupon&quot;))))</span>
<span class="nc" id="L490">			return null;</span>

<span class="nc" id="L492">		if (null == (bpb._dtMaturity = org.drip.analytics.date.DateUtil.MakeJulianFromYYYYMMDD</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">			(mapJSON.get (&quot;maturity&quot;), &quot;-&quot;)))</span>
<span class="nc" id="L494">			return null;</span>

<span class="nc" id="L496">		bpb._iCouponFreq = java.lang.Integer.parseInt (mapJSON.get (&quot;frequency&quot;));</span>

<span class="nc" id="L498">		bpb._strCouponType = mapJSON.get (&quot;couponType&quot;);</span>

<span class="nc" id="L500">		bpb._strMaturityType = mapJSON.get (&quot;maturityType&quot;);</span>

<span class="nc" id="L502">		bpb._strCalculationType = mapJSON.get (&quot;calcType&quot;);</span>

<span class="nc" id="L504">		bpb._strDayCountCode = mapJSON.get (&quot;dayCount&quot;);</span>

<span class="nc" id="L506">		bpb._dblRedemptionValue = java.lang.Double.parseDouble (mapJSON.get (&quot;redempValue&quot;));</span>

<span class="nc bnc" id="L508" title="All 2 branches missed.">		if (null == (bpb._strRedemptionCurrency = mapJSON.get (&quot;redempCrncy&quot;)) ||</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">			bpb._strRedemptionCurrency.isEmpty()) {</span>
<span class="nc" id="L510">			System.out.println (&quot;Invalid redemption currency for &quot; + DES (bpb));</span>

<span class="nc" id="L512">			return null;</span>
		}

<span class="nc bnc" id="L515" title="All 4 branches missed.">		if (null == (bpb._strCouponCurrency = mapJSON.get (&quot;cpnCrncy&quot;)) || bpb._strCouponCurrency.isEmpty())</span>
		{
<span class="nc" id="L517">			System.out.println (&quot;Invalid Coupon currency for &quot; + DES (bpb));</span>

<span class="nc" id="L519">			return null;</span>
		}

<span class="nc bnc" id="L522" title="All 4 branches missed.">		if (null == (bpb._strTradeCurrency = mapJSON.get (&quot;tradeCrncy&quot;)) || bpb._strTradeCurrency.isEmpty())</span>
		{
<span class="nc" id="L524">			System.out.println (&quot;Invalid Trade currency for &quot; + DES (bpb));</span>

<span class="nc" id="L526">			return null;</span>
		}

<span class="nc" id="L529">		if (null == (bpb._dtFirstCoupon = org.drip.analytics.date.DateUtil.MakeJulianFromYYYYMMDD</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">			(mapJSON.get (&quot;firstCpnDate&quot;), &quot;-&quot;)))</span>
<span class="nc" id="L531">			return null;</span>

<span class="nc" id="L533">		if (null == (bpb._dtIssue = org.drip.analytics.date.DateUtil.MakeJulianFromYYYYMMDD</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">			(mapJSON.get (&quot;issueDate&quot;), &quot;-&quot;)))</span>
<span class="nc" id="L535">			return null;</span>

		try {
<span class="nc" id="L538">			bpb._bIsCallable = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;callable&quot;));</span>

<span class="nc" id="L540">			bpb._bIsPutable = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;putable&quot;));</span>

<span class="nc" id="L542">			bpb._bIsSinkable = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;sinkable&quot;));</span>

<span class="nc" id="L544">			bpb._bHasBeenCalled = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;called&quot;));</span>

			// bpb._strFloatCouponConvention = rs.getString (&quot;FloatCouponConvention&quot;);

<span class="nc" id="L548">			bpb._bIsFloater = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;floater&quot;));</span>

			// bpb._dblCurrentCoupon = 0.01 * rs.getDouble (&quot;CurrentCoupon&quot;);

<span class="nc" id="L552">			if (null == (bpb._dtFinalMaturity = org.drip.analytics.date.DateUtil.MakeJulianFromYYYYMMDD</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">				(mapJSON.get (&quot;finalMaturityDt&quot;), &quot;-&quot;)))</span>
<span class="nc" id="L554">				return null;</span>

<span class="nc" id="L556">			bpb._bIsPerpetual = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;perpetual&quot;));</span>

<span class="nc" id="L558">			bpb._bIsDefaulted = java.lang.Boolean.parseBoolean (mapJSON.get (&quot;defaulted&quot;));</span>

			// bpb._dblFloatSpread = java.lang.Double.parseDouble (mapJSON.get (&quot;quotedMargin&quot;));

<span class="nc" id="L562">			bpb._strRateIndex = mapJSON.get (&quot;resetIndex&quot;);</span>

<span class="nc bnc" id="L564" title="All 6 branches missed.">			if (bpb._bIsFloater &amp;&amp; !org.drip.quant.common.NumberUtil.IsValid (bpb._dblFloatSpread) &amp;&amp; (null ==</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">				bpb._strRateIndex || bpb._strRateIndex.isEmpty())) {</span>
<span class="nc" id="L566">				System.out.println (&quot;Invalid float spread for &quot; + DES (bpb));</span>

<span class="nc" id="L568">				return null;</span>
			}

			// bpb._strIssuerSPN = rs.getString (&quot;SPN&quot;);

<span class="nc bnc" id="L573" title="All 2 branches missed.">			if (!bpb.validate (mpc)) return null;</span>

			if (m_bBlog) System.out.println (&quot;Loaded &quot; + DES (bpb) + &quot;.&quot;);

<span class="nc" id="L577">			return bpb;</span>
<span class="nc" id="L578">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L579">			e.printStackTrace();</span>
		}

<span class="nc" id="L582">		return null;</span>
	}

	/**
	 * Empty BondProductBuilder ctr - uninitialized members
	 */

	public BondProductBuilder()
<span class="nc" id="L590">	{</span>
<span class="nc" id="L591">	}</span>

	/**
	 * Set the Bond ISIN
	 * 
	 * @param strISIN ISIN input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setISIN (
		final java.lang.String strISIN)
	{
<span class="nc bnc" id="L604" title="All 6 branches missed.">		if (null == strISIN || strISIN.trim().isEmpty() || &quot;null&quot;.equalsIgnoreCase (strISIN.trim()))</span>
<span class="nc" id="L605">			return false;</span>

<span class="nc" id="L607">		_strISIN = strISIN;</span>
<span class="nc" id="L608">		return true;</span>
	}

	/**
	 * Set the Bond CUSIP
	 * 
	 * @param strCUSIP CUSIP input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCUSIP (
		final java.lang.String strCUSIP)
	{
<span class="nc bnc" id="L622" title="All 6 branches missed.">		if (null == strCUSIP || strCUSIP.trim().isEmpty() || &quot;null&quot;.equalsIgnoreCase (strCUSIP.trim()))</span>
<span class="nc" id="L623">			return false;</span>

<span class="nc" id="L625">		_strCUSIP = strCUSIP;</span>
<span class="nc" id="L626">		return true;</span>
	}

	/**
	 * Set the Bond Ticker
	 * 
	 * @param strTicker Ticker input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setTicker (
		final java.lang.String strTicker)
	{
<span class="nc bnc" id="L640" title="All 2 branches missed.">		if (null == (_strTicker = strTicker.trim())) _strTicker = &quot;&quot;;</span>

<span class="nc" id="L642">		return true;</span>
	}

	/**
	 * Set the Bond Coupon
	 * 
	 * @param strCoupon Coupon input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCoupon (
		final java.lang.String strCoupon)
	{
<span class="nc bnc" id="L656" title="All 6 branches missed.">		if (null == strCoupon || strCoupon.trim().isEmpty() || &quot;null&quot;.equalsIgnoreCase (strCoupon.trim()))</span>
<span class="nc" id="L657">			_dblCoupon = 0.;</span>

		try {
<span class="nc" id="L660">			_dblCoupon = java.lang.Double.parseDouble (strCoupon.trim());</span>

<span class="nc" id="L662">			return true;</span>
<span class="nc" id="L663">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad coupon &quot; + strCoupon + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L667">		return false;</span>
	}

	/**
	 * Set the Bond Maturity
	 * 
	 * @param strMaturity Maturity input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setMaturity (
		final java.lang.String strMaturity)
	{
		try {
<span class="nc" id="L682">			if (null == (_dtMaturity = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">				(strMaturity.trim())))</span>
<span class="nc" id="L684">				return false;</span>

<span class="nc" id="L686">			return true;</span>
<span class="nc" id="L687">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad Maturity &quot; + strMaturity + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L691">		return false;</span>
	}

	/**
	 * Set the Bond Coupon Frequency
	 * 
	 * @param strCouponFreq Coupon Frequency input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCouponFreq (
		final java.lang.String strCouponFreq)
	{
<span class="nc bnc" id="L705" title="All 6 branches missed.">		if (null == strCouponFreq || strCouponFreq.isEmpty() || &quot;null&quot;.equalsIgnoreCase (strCouponFreq))</span>
<span class="nc" id="L706">			_iCouponFreq = 0;</span>
		else {
			try {
<span class="nc" id="L709">				_iCouponFreq = (int) java.lang.Double.parseDouble (strCouponFreq.trim());</span>
<span class="nc" id="L710">			} catch (java.lang.Exception e) {</span>
				if (m_bBlog) System.out.println (&quot;Bad Cpn Freq &quot; + strCouponFreq + &quot; for ISIN &quot; + _strISIN);

<span class="nc" id="L713">				return false;</span>
<span class="nc" id="L714">			}</span>
		}

<span class="nc" id="L717">		return true;</span>
	}

	/**
	 * Set the Bond Coupon Type
	 * 
	 * @param strCouponType Coupon Type input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCouponType (
		final java.lang.String strCouponType)
	{
<span class="nc bnc" id="L731" title="All 2 branches missed.">		if (null == (_strCouponType = strCouponType.trim())) _strCouponType = &quot;&quot;;</span>

<span class="nc" id="L733">		return true;</span>
	}

	/**
	 * Set the Bond Maturity Type
	 * 
	 * @param strMaturityType Maturity Type input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setMaturityType (
		final java.lang.String strMaturityType)
	{
<span class="nc bnc" id="L747" title="All 2 branches missed.">		if (null == (_strMaturityType = strMaturityType.trim())) _strMaturityType = &quot;&quot;;</span>

<span class="nc" id="L749">		return true;</span>
	}

	/**
	 * Set the Bond Calculation Type
	 * 
	 * @param strCalculationType Calculation Type input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCalculationType (
		final java.lang.String strCalculationType)
	{
<span class="nc bnc" id="L763" title="All 2 branches missed.">		if (null == (_strCalculationType = strCalculationType.trim())) _strCalculationType = &quot;&quot;;</span>

<span class="nc" id="L765">		return true;</span>
	}

	/**
	 * Set the Bond Day Count Code
	 * 
	 * @param strDayCountCode Day Count Code input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setDayCountCode (
		final java.lang.String strDayCountCode)
	{
<span class="nc" id="L779">		_strDayCountCode = &quot;Unknown DC&quot;;</span>

		try {
<span class="nc" id="L782">			_strDayCountCode = org.drip.analytics.support.Helper.ParseFromBBGDCCode</span>
<span class="nc" id="L783">				(strDayCountCode.trim());</span>

<span class="nc" id="L785">			return true;</span>
<span class="nc" id="L786">		} catch (java.lang.Exception e) {</span>
		}

<span class="nc" id="L789">		return false;</span>
	}

	/**
	 * Set the Bond Redemption Value
	 * 
	 * @param strRedemptionValue Redemption Value input
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setRedemptionValue (
		final java.lang.String strRedemptionValue)
	{
		try {
<span class="nc" id="L804">			_dblRedemptionValue = java.lang.Double.parseDouble (strRedemptionValue.trim());</span>

<span class="nc" id="L806">			return true;</span>
<span class="nc" id="L807">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L808">			System.out.println (&quot;Bad Redemption Value &quot; + strRedemptionValue + &quot; for ISIN &quot; + _strISIN);</span>
		}

<span class="nc" id="L811">		return false;</span>
	}

	/**
	 * Set the Bond Announce
	 * 
	 * @param strAnnounce Announce Date String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setAnnounce (
		final java.lang.String strAnnounce)
	{
		try {
<span class="nc" id="L826">			_dtAnnounce = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate (strAnnounce.trim());</span>

<span class="nc" id="L828">			return true;</span>
<span class="nc" id="L829">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad Announce &quot; + strAnnounce + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L833">		return false;</span>
	}

	/**
	 * Set the Bond First Settle
	 * 
	 * @param strFirstSettle First Settle Date String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFirstSettle (
		final java.lang.String strFirstSettle)
	{
		try {
<span class="nc" id="L848">			_dtFirstSettle = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate</span>
<span class="nc" id="L849">				(strFirstSettle.trim());</span>

<span class="nc" id="L851">			return true;</span>
<span class="nc" id="L852">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad First Settle &quot; + strFirstSettle + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L856">		return false;</span>
	}

	/**
	 * Set the Bond First Coupon Date
	 * 
	 * @param strFirstCoupon First Coupon Date String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFirstCoupon (
		final java.lang.String strFirstCoupon)
	{
		try {
<span class="nc" id="L871">			_dtFirstCoupon = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate</span>
<span class="nc" id="L872">				(strFirstCoupon.trim());</span>

<span class="nc" id="L874">			return true;</span>
<span class="nc" id="L875">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad First Coupon &quot; + strFirstCoupon + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L879">		return false;</span>
	}

	/**
	 * Set the Bond Interest Accrual Start Date
	 * 
	 * @param strInterestAccrualStart Interest Accrual Start Date String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setInterestAccrualStart (
		final java.lang.String strInterestAccrualStart)
	{
		try {
<span class="nc" id="L894">			_dtInterestAccrualStart = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate</span>
<span class="nc" id="L895">				(strInterestAccrualStart.trim());</span>

<span class="nc" id="L897">			return true;</span>
<span class="nc" id="L898">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog)
				System.out.println (&quot;Bad Announce &quot; + strInterestAccrualStart + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L903">		return false;</span>
	}

	/**
	 * Set the Bond Issue Date
	 * 
	 * @param strIssue Issue Date String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIssue (
		final java.lang.String strIssue)
	{
		try {
<span class="nc" id="L918">			_dtIssue = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate (strIssue.trim());</span>

<span class="nc" id="L920">			return true;</span>
<span class="nc" id="L921">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad Issue &quot; + strIssue + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L925">		return false;</span>
	}

	/**
	 * Set whether the Bond Is Callable
	 * 
	 * @param strCallable Callable String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsCallable (
		final java.lang.String strCallable)
	{
<span class="nc bnc" id="L939" title="All 2 branches missed.">		if (null == strCallable) _bIsCallable = false;</span>

<span class="nc bnc" id="L941" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strCallable.trim()))</span>
<span class="nc" id="L942">			_bIsCallable = true;</span>
		else
<span class="nc" id="L944">			_bIsCallable = false;</span>

<span class="nc" id="L946">		return true;</span>
	}

	/**
	 * Set whether the Bond Is Putable
	 * 
	 * @param strPutable Putable String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsPutable (
		final java.lang.String strPutable)
	{
<span class="nc bnc" id="L960" title="All 2 branches missed.">		if (null == strPutable) _bIsPutable = false;</span>

<span class="nc bnc" id="L962" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strPutable.trim()))</span>
<span class="nc" id="L963">			_bIsPutable = true;</span>
		else
<span class="nc" id="L965">			_bIsPutable = false;</span>

<span class="nc" id="L967">		return true;</span>
	}

	/**
	 * Set whether the Bond Is Sinkable
	 * 
	 * @param strSinkable Sinkable String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsSinkable (
		final java.lang.String strSinkable)
	{
<span class="nc bnc" id="L981" title="All 2 branches missed.">		if (null == strSinkable) _bIsSinkable = false;</span>

<span class="nc bnc" id="L983" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strSinkable.trim()))</span>
<span class="nc" id="L984">			_bIsSinkable = true;</span>
		else
<span class="nc" id="L986">			_bIsSinkable = false;</span>

<span class="nc" id="L988">		return true;</span>
	}

	/**
	 * Set The redemption Currency
	 * 
	 * @param strRedemptionCurrency Redemption Currency String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setRedemptionCurrency (
		final java.lang.String strRedemptionCurrency)
	{
<span class="nc bnc" id="L1002" title="All 2 branches missed.">		if (null == (_strRedemptionCurrency = strRedemptionCurrency.trim()) || &quot;null&quot;.equalsIgnoreCase</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">			(strRedemptionCurrency.trim()))</span>
<span class="nc" id="L1004">			return false;</span>

<span class="nc" id="L1006">		return true;</span>
	}

	/**
	 * Set The Coupon Currency
	 * 
	 * @param strCouponCurrency Coupon Currency String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCouponCurrency (
		final java.lang.String strCouponCurrency)
	{
<span class="nc bnc" id="L1020" title="All 2 branches missed.">		if (null == (_strCouponCurrency = strCouponCurrency.trim()) || &quot;null&quot;.equalsIgnoreCase</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">			(strCouponCurrency.trim()))</span>
<span class="nc" id="L1022">			return false;</span>

<span class="nc" id="L1024">		return true;</span>
	}

	/**
	 * Set The Trade Currency
	 * 
	 * @param strTradeCurrency Trade Currency String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setTradeCurrency (
		final java.lang.String strTradeCurrency)
	{
<span class="nc bnc" id="L1038" title="All 2 branches missed.">		if (null == (_strTradeCurrency = strTradeCurrency.trim()) || &quot;null&quot;.equalsIgnoreCase</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">			(strTradeCurrency.trim()))</span>
<span class="nc" id="L1040">			return false;</span>

<span class="nc" id="L1042">		return true;</span>
	}

	/**
	 * Set whether the bond Has Been Called
	 * 
	 * @param strHasBeenCalled Has Been Called String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setHasBeenCalled (
		final java.lang.String strHasBeenCalled)
	{
<span class="nc bnc" id="L1056" title="All 2 branches missed.">		if (null == strHasBeenCalled) _bHasBeenCalled = false;</span>

<span class="nc bnc" id="L1058" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strHasBeenCalled.trim()))</span>
<span class="nc" id="L1059">			_bHasBeenCalled = true;</span>
		else
<span class="nc" id="L1061">			_bHasBeenCalled = false;</span>

<span class="nc" id="L1063">		return true;</span>
	}

	/**
	 * Set the bond's Float Coupon Convention
	 * 
	 * @param strFloatCouponConvention Float Coupon Convention String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFloatCouponConvention (
		final java.lang.String strFloatCouponConvention)
	{
<span class="nc bnc" id="L1077" title="All 2 branches missed.">		if (null == (_strFloatCouponConvention = strFloatCouponConvention.trim()))</span>
<span class="nc" id="L1078">			_strFloatCouponConvention = &quot;&quot;;</span>

<span class="nc" id="L1080">		return true;</span>
	}

	/**
	 * Set the bond's Current Coupon
	 * 
	 * @param strCurrentCoupon Current Coupon String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setCurrentCoupon (
		final java.lang.String strCurrentCoupon)
	{
<span class="nc bnc" id="L1094" title="All 4 branches missed.">		if (null == strCurrentCoupon || strCurrentCoupon.trim().isEmpty() || &quot;null&quot;.equalsIgnoreCase</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">			(strCurrentCoupon.trim()))</span>
<span class="nc" id="L1096">			_dblCurrentCoupon = 0.;</span>
		else {
			try {
<span class="nc" id="L1099">				_dblCurrentCoupon = java.lang.Double.parseDouble (strCurrentCoupon.trim());</span>

<span class="nc" id="L1101">				return true;</span>
<span class="nc" id="L1102">			} catch (java.lang.Exception e) {</span>
				if (m_bBlog)
					System.out.println (&quot;Bad Curr Cpn &quot; + strCurrentCoupon + &quot; for ISIN &quot; + _strISIN);
			}
		}

<span class="nc" id="L1108">		return false;</span>
	}

	/**
	 * Set whether the bond is a floater or not
	 * 
	 * @param strIsFloater String indicating whether the bond is a floater
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsFloater (
		final java.lang.String strIsFloater)
	{
<span class="nc bnc" id="L1122" title="All 2 branches missed.">		if (null == strIsFloater) _bIsFloater = false;</span>

<span class="nc bnc" id="L1124" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strIsFloater.trim()))</span>
<span class="nc" id="L1125">			_bIsFloater = true;</span>
		else
<span class="nc" id="L1127">			_bIsFloater = false;</span>

<span class="nc" id="L1129">		return true;</span>
	}

	/**
	 * Set the final maturity of the bond
	 * 
	 * @param strFinalMaturity String representing the bond's final maturity
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFinalMaturity (
		final java.lang.String strFinalMaturity)
	{
		try {
<span class="nc" id="L1144">			_dtFinalMaturity = org.drip.analytics.date.DateUtil.MakeJulianDateFromBBGDate</span>
<span class="nc" id="L1145">				(strFinalMaturity.trim());</span>

<span class="nc" id="L1147">			return true;</span>
<span class="nc" id="L1148">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog)
				System.out.println (&quot;Bad Final Maturity &quot; + strFinalMaturity + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L1153">		return false;</span>
	}

	/**
	 * Set whether the bond is perpetual or not
	 * 
	 * @param strIsPerpetual String representing whether the bond is perpetual or not
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsPerpetual (
		final java.lang.String strIsPerpetual)
	{
<span class="nc bnc" id="L1167" title="All 2 branches missed.">		if (null == strIsPerpetual) _bIsPerpetual = false;</span>

<span class="nc bnc" id="L1169" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strIsPerpetual.trim()))</span>
<span class="nc" id="L1170">			_bIsPerpetual = true;</span>
		else
<span class="nc" id="L1172">			_bIsPerpetual = false;</span>

<span class="nc" id="L1174">		return true;</span>
	}

	/**
	 * Set whether the bond is defaulted or not
	 * 
	 * @param strIsDefaulted String representing whether the bond is defaulted or not
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIsDefaulted (
		final java.lang.String strIsDefaulted)
	{
<span class="nc bnc" id="L1188" title="All 2 branches missed.">		if (null == strIsDefaulted) _bIsDefaulted = false;</span>

<span class="nc bnc" id="L1190" title="All 2 branches missed.">		if (&quot;1&quot;.equalsIgnoreCase (strIsDefaulted.trim()))</span>
<span class="nc" id="L1191">			_bIsDefaulted = true;</span>
		else
<span class="nc" id="L1193">			_bIsDefaulted = false;</span>

<span class="nc" id="L1195">		return true;</span>
	}

	/**
	 * Set the bond's floating rate spread
	 * 
	 * @param strFloatSpread String representing the bond's floating spread
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFloatSpread (
		final java.lang.String strFloatSpread)
	{
		try {
<span class="nc" id="L1210">			_dblFloatSpread = java.lang.Double.parseDouble (strFloatSpread.trim());</span>

<span class="nc" id="L1212">			return true;</span>
<span class="nc" id="L1213">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) System.out.println (&quot;Bad Float Spread &quot; + strFloatSpread + &quot; for ISIN &quot; + _strISIN);
		}

<span class="nc" id="L1217">		return false;</span>
	}

	/**
	 * Set the bond's floating rate spread from the MPC
	 * 
	 * @param mpc org.drip.param.definition.MarketParams
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setFloatSpread (
		final org.drip.param.definition.ScenarioMarketParams mpc)
	{
<span class="nc bnc" id="L1231" title="All 2 branches missed.">		if (!org.drip.quant.common.NumberUtil.IsValid (_dblCurrentCoupon)) {</span>
<span class="nc" id="L1232">			System.out.println (&quot;Curr cpn for ISIN &quot; + _strISIN + &quot; is NaN!&quot;);</span>

<span class="nc" id="L1234">			return false;</span>
		}

<span class="nc bnc" id="L1237" title="All 6 branches missed.">		if (null == mpc || null == mpc.scenarioDiscountCurveMap() || null == mpc.scenarioDiscountCurveMap().get (_strCouponCurrency) ||</span>
<span class="nc bnc" id="L1238" title="All 2 branches missed.">			null == mpc.scenarioDiscountCurveMap().get (_strCouponCurrency).base()) {</span>
			if (m_bBlog) System.out.println (&quot;Bad mpc In for ISIN &quot; + _strISIN);

<span class="nc" id="L1241">			return false;</span>
		}

		try {
<span class="nc bnc" id="L1245" title="All 2 branches missed.">			if (0. != _dblCurrentCoupon) {</span>
<span class="nc" id="L1246">				org.drip.state.discount.MergedDiscountForwardCurve dcBase = mpc.scenarioDiscountCurveMap().get (_strCouponCurrency).base();</span>

<span class="nc" id="L1248">				_dblFloatSpread = _dblCurrentCoupon - 100. * dcBase.libor (dcBase.epoch().julian(),</span>
<span class="nc" id="L1249">					(org.drip.analytics.support.Helper.GetTenorFromFreq (_iCouponFreq)));</span>
<span class="nc" id="L1250">			} else</span>
<span class="nc" id="L1251">				_dblFloatSpread = 0.;</span>

<span class="nc" id="L1253">			return true;</span>
<span class="nc" id="L1254">		} catch (java.lang.Exception e) {</span>
			if (m_bBlog) e.printStackTrace();
		}

<span class="nc" id="L1258">		return false;</span>
	}

	/**
	 * Set the bond's Rate Index
	 * 
	 * @param strRateIndex Rate Index
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setRateIndex (
		final java.lang.String strRateIndex)
	{
<span class="nc bnc" id="L1272" title="All 2 branches missed.">		if (null == (_strRateIndex = strRateIndex)) _strRateIndex = &quot;&quot;;</span>

<span class="nc" id="L1274">		return true;</span>
	}

	/**
	 * Set the bond's Issuer SPN
	 * 
	 * @param strIssuerSPN Issuer SPN String
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean setIssuerSPN (
		final java.lang.String strIssuerSPN)
	{
<span class="nc bnc" id="L1288" title="All 2 branches missed.">		if (null == (_strIssuerSPN = strIssuerSPN)) _strIssuerSPN = &quot;&quot;;</span>

<span class="nc" id="L1290">		return true;</span>
	}

	/**
	 * Validate the state
	 * 
	 * @param mpc org.drip.param.definition.MarketParams
	 * 
	 * @return Success (true), failure (false)
	 */

	public boolean validate (
		final org.drip.param.definition.ScenarioMarketParams mpc)
	{
<span class="nc bnc" id="L1304" title="All 8 branches missed.">		if (null == _strISIN || _strISIN.isEmpty() || null == _strCUSIP || _strCUSIP.isEmpty()) {</span>
			if (m_bDisplayWarnings)
<span class="nc" id="L1306">				System.out.println (&quot;Check ISIN[&quot; + _strISIN + &quot;] or CUSIP[&quot; + _strCUSIP + &quot;]&quot;);</span>

<span class="nc" id="L1308">			return false;</span>
		}

<span class="nc bnc" id="L1311" title="All 4 branches missed.">		if (0 == _iCouponFreq &amp;&amp; 0. != _dblCoupon) {</span>
			if (m_bDisplayWarnings)
<span class="nc" id="L1313">				System.out.println (&quot;Coupon Freq and Cpn amt both not sero for ISIN[&quot; + _strISIN + &quot;]&quot;);</span>

<span class="nc" id="L1315">			return false;</span>
		}

<span class="nc bnc" id="L1318" title="All 4 branches missed.">		if (49 == _iCouponFreq || 52 == _iCouponFreq) {</span>
			if (m_bDisplayWarnings)
<span class="nc" id="L1320">				System.out.println (&quot;ISIN[&quot; + _strISIN + &quot;] has cpn freq of &quot; + _iCouponFreq + &quot;!&quot;);</span>

<span class="nc" id="L1322">			return false;</span>
		}

<span class="nc bnc" id="L1325" title="All 2 branches missed.">		if (null == _dtInterestAccrualStart) {</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">			if (null == (_dtInterestAccrualStart = reconcileStartDate())) {</span>
				if (m_bDisplayWarnings)
<span class="nc" id="L1328">					System.out.println (&quot;All possible date init candidates are null for ISIN &quot; + _strISIN);</span>

<span class="nc" id="L1330">				return false;</span>
			}
		}

<span class="nc bnc" id="L1334" title="All 6 branches missed.">		if (_bIsFloater &amp;&amp; (null == _strRateIndex || _strRateIndex.isEmpty()) &amp;&amp;</span>
<span class="nc bnc" id="L1335" title="All 2 branches missed.">			!org.drip.quant.common.NumberUtil.IsValid (_dblFloatSpread) &amp;&amp; java.lang.Double.isNaN</span>
<span class="nc bnc" id="L1336" title="All 2 branches missed.">				(_dblCurrentCoupon)) {</span>
			if (m_bDisplayWarnings)
<span class="nc" id="L1338">				System.out.println (&quot;Invalid Rate index &amp; float spread &amp; current coupon for &quot; + _strISIN);</span>

<span class="nc" id="L1340">			return false;</span>
		}

<span class="nc bnc" id="L1343" title="All 6 branches missed.">		if (_bIsFloater &amp;&amp; (null == _strRateIndex || _strRateIndex.isEmpty())) {</span>
<span class="nc" id="L1344">			if (null == (_strRateIndex = org.drip.analytics.support.Helper.CalcRateIndex</span>
<span class="nc bnc" id="L1345" title="All 2 branches missed.">				(_strCouponCurrency, _iCouponFreq))) {</span>
				if (m_bDisplayWarnings)
<span class="nc" id="L1347">					System.out.println (&quot;Warning: Cannot find Rate index for ISIN &quot; + _strISIN);</span>
			}
		}

<span class="nc bnc" id="L1351" title="All 4 branches missed.">		if (_bIsFloater &amp;&amp; !org.drip.quant.common.NumberUtil.IsValid (_dblFloatSpread)) {</span>
			try {
<span class="nc bnc" id="L1353" title="All 2 branches missed.">				if (!setFloatSpread (mpc)) {</span>
					if (m_bDisplayWarnings)
<span class="nc" id="L1355">						System.out.println (&quot;Warning: Cannot set float spread for ISIN &quot; + _strISIN +</span>
							&quot; and Coupon Currency &quot; + _strCouponCurrency);
				}
<span class="nc" id="L1358">			} catch (java.lang.Exception e) {</span>
				if (m_bDisplayWarnings)
<span class="nc" id="L1360">					System.out.println (&quot;Warning: Cannot set float spread for ISIN &quot; + _strISIN +</span>
						&quot; and Coupon Currency &quot; + _strCouponCurrency);

<span class="nc" id="L1363">				e.printStackTrace();</span>
<span class="nc" id="L1364">			}</span>
		}

<span class="nc bnc" id="L1367" title="All 2 branches missed.">		if (null == _dtIssue) _dtIssue = reconcileStartDate();</span>

<span class="nc bnc" id="L1369" title="All 2 branches missed.">		if (null == _dtFirstSettle) _dtFirstSettle = reconcileStartDate();</span>

<span class="nc bnc" id="L1371" title="All 2 branches missed.">		if (null == _dtAnnounce) _dtAnnounce = reconcileStartDate();</span>

<span class="nc" id="L1373">		return true;</span>
	}

	/**
	 * Create an SQL Insert statement from the object's state
	 * 
	 * @return String representing the SQL Insert
	 */

	public java.lang.String makeSQLInsert()
	{
<span class="nc" id="L1384">		java.lang.StringBuilder sb = new java.lang.StringBuilder();</span>

<span class="nc" id="L1386">		sb.append (&quot;insert into BondValData values(&quot;);</span>

<span class="nc" id="L1388">		sb.append (&quot;'&quot;).append (_strISIN).append (&quot;', &quot;);</span>

<span class="nc" id="L1390">		sb.append (&quot;'&quot;).append (_strCUSIP).append (&quot;', &quot;);</span>

<span class="nc" id="L1392">		sb.append (&quot;'&quot;).append (_strTicker).append (&quot;', &quot;);</span>

<span class="nc" id="L1394">		sb.append (_dblCoupon).append (&quot;, &quot;);</span>

<span class="nc" id="L1396">		sb.append (&quot;'&quot;).append (_dtMaturity.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc" id="L1398">		sb.append (_iCouponFreq).append (&quot;, &quot;);</span>

<span class="nc" id="L1400">		sb.append (&quot;'&quot;).append (_strCouponType).append (&quot;', &quot;);</span>

<span class="nc" id="L1402">		sb.append (&quot;'&quot;).append (_strMaturityType).append (&quot;', &quot;);</span>

<span class="nc" id="L1404">		sb.append (&quot;'&quot;).append (_strCalculationType).append (&quot;', &quot;);</span>

<span class="nc" id="L1406">		sb.append (&quot;'&quot;).append (_strDayCountCode).append (&quot;', &quot;);</span>

<span class="nc" id="L1408">		sb.append (_dblRedemptionValue).append (&quot;, &quot;);</span>

<span class="nc" id="L1410">		sb.append (&quot;'&quot;).append (_dtAnnounce.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc" id="L1412">		sb.append (&quot;'&quot;).append (_dtFirstSettle.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1414" title="All 2 branches missed.">		if (null == _dtFirstCoupon)</span>
<span class="nc" id="L1415">			sb.append (&quot;null, &quot;);</span>
		else
<span class="nc" id="L1417">			sb.append (&quot;'&quot;).append (_dtFirstCoupon.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc" id="L1419">		sb.append (&quot;'&quot;).append (_dtInterestAccrualStart.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc" id="L1421">		sb.append (&quot;'&quot;).append (_dtIssue.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1423" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsCallable ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1425" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsPutable ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1427" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsSinkable ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc" id="L1429">		sb.append (&quot;'&quot;).append (_strRedemptionCurrency).append (&quot;', &quot;);</span>

<span class="nc" id="L1431">		sb.append (&quot;'&quot;).append (_strCouponCurrency).append (&quot;', &quot;);</span>

<span class="nc" id="L1433">		sb.append (&quot;'&quot;).append (_strTradeCurrency).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1435" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bHasBeenCalled ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc" id="L1437">		sb.append (&quot;'&quot;).append (_strFloatCouponConvention).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1439" title="All 2 branches missed.">		if (!org.drip.quant.common.NumberUtil.IsValid (_dblCurrentCoupon))</span>
<span class="nc" id="L1440">			sb.append (&quot;null, &quot;);</span>
		else
<span class="nc" id="L1442">			sb.append (_dblCurrentCoupon).append (&quot;, &quot;);</span>

<span class="nc bnc" id="L1444" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsFloater ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1446" title="All 2 branches missed.">		if (null == _dtFinalMaturity)</span>
<span class="nc" id="L1447">			sb.append (&quot;null, &quot;);</span>
		else
<span class="nc" id="L1449">			sb.append (&quot;'&quot;).append (_dtFinalMaturity.toOracleDate()).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1451" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsPerpetual ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1453" title="All 2 branches missed.">		sb.append (&quot;'&quot;).append (_bIsDefaulted ? 1 : 0).append (&quot;', &quot;);</span>

<span class="nc bnc" id="L1455" title="All 2 branches missed.">		if (!org.drip.quant.common.NumberUtil.IsValid (_dblFloatSpread))</span>
<span class="nc" id="L1456">			sb.append (&quot;null, &quot;);</span>
		else
<span class="nc" id="L1458">			sb.append (_dblFloatSpread).append (&quot;, &quot;);</span>

<span class="nc" id="L1460">		sb.append (&quot;'&quot;).append (_strRateIndex).append (&quot;', &quot;);</span>

<span class="nc" id="L1462">		sb.append (&quot;'&quot;).append (_strIssuerSPN).append (&quot;')&quot;);</span>

<span class="nc" id="L1464">		return sb.toString();</span>
	}

	/**
	 * Get the Bond's identifier Parameters
	 * 
	 * @return BondIdentifierParams object
	 */

	public org.drip.product.params.IdentifierSet getIdentifierParams()
	{
<span class="nc" id="L1475">		org.drip.product.params.IdentifierSet idParams = new org.drip.product.params.IdentifierSet (_strISIN,</span>
			_strCUSIP, _strISIN, _strTicker);

<span class="nc bnc" id="L1478" title="All 2 branches missed.">		return idParams.validate() ? idParams : null;</span>
	}

	/**
	 * Get the Bond's Coupon Parameters
	 * 
	 * @return BondCouponParams object
	 */

	public org.drip.product.params.CouponSetting getCouponParams()
	{
<span class="nc" id="L1489">		org.drip.product.params.CouponSetting cpnParams = new org.drip.product.params.CouponSetting</span>
			(null, _strCouponType, _dblCoupon, java.lang.Double.NaN, java.lang.Double.NaN);

<span class="nc bnc" id="L1492" title="All 2 branches missed.">		return cpnParams.validate() ? cpnParams : null;</span>
	}

	/**
	 * Get the Bond's Floater Parameters
	 * 
	 * @return BondFloaterParams object
	 */

	public org.drip.product.params.FloaterSetting getFloaterParams()
	{
<span class="nc bnc" id="L1503" title="All 2 branches missed.">		if (!_bIsFloater) return null;</span>

<span class="nc" id="L1505">		org.drip.product.params.FloaterSetting fltParams = new org.drip.product.params.FloaterSetting (</span>
<span class="nc" id="L1506">			org.drip.state.identifier.ForwardLabel.Standard (_strRateIndex),</span>
			_strFloatCouponConvention,
			_dblFloatSpread,
			_dblCurrentCoupon
		);

<span class="nc bnc" id="L1512" title="All 2 branches missed.">		return fltParams.validate() ? fltParams : null;</span>
	}

	/**
	 * Get the Bond's Market Convention
	 * 
	 * @return MarketConvention object
	 */

	public org.drip.product.params.QuoteConvention getMarketConvention()
	{
<span class="nc" id="L1523">		org.drip.product.params.QuoteConvention mktConv = new org.drip.product.params.QuoteConvention (null,</span>
<span class="nc" id="L1524">			_strCalculationType, _dtFirstSettle.julian(), _dblRedemptionValue, 0, &quot;&quot;,</span>
				org.drip.analytics.daycount.Convention.DATE_ROLL_ACTUAL);

<span class="nc bnc" id="L1527" title="All 2 branches missed.">		return mktConv.validate() ? mktConv : null;</span>
	}

	/**
	 * Get the Bond's Credit Component Parameters
	 * 
	 * @return CompCRValParams object
	 */

	public org.drip.product.params.CreditSetting getCRValuationParams()
	{
<span class="nc" id="L1538">		org.drip.product.params.CreditSetting crValParams = new org.drip.product.params.CreditSetting (30,</span>
			java.lang.Double.NaN, true, &quot;&quot;, true);

<span class="nc bnc" id="L1541" title="All 2 branches missed.">		return crValParams.validate() ? crValParams : null;</span>
	}

	/**
	 * Get the Bond's CF termination event Parameters
	 * 
	 * @return BondCFTerminationEvent object
	 */

	public org.drip.product.params.TerminationSetting getCFTEParams()
	{
<span class="nc" id="L1552">		org.drip.product.params.TerminationSetting cfteParams = new</span>
			org.drip.product.params.TerminationSetting (_bIsPerpetual, _bIsDefaulted, _bHasBeenCalled, null);

<span class="nc bnc" id="L1555" title="All 2 branches missed.">		return cfteParams.validate() ? cfteParams : null;</span>
	}

	/**
	 * Get the Bond's Notional Parameters
	 * 
	 * @return BondNotionalParams object
	 */

	public org.drip.product.params.NotionalSetting getNotionalParams()
	{
<span class="nc" id="L1566">		org.drip.product.params.NotionalSetting notlParams = new org.drip.product.params.NotionalSetting</span>
			(100., _strRedemptionCurrency, null,
				org.drip.product.params.NotionalSetting.PERIOD_AMORT_AT_START, false);

<span class="nc bnc" id="L1570" title="All 2 branches missed.">		return notlParams.validate() ? notlParams : null;</span>
	}

	/**
	 * Get the Bond's Period Generation Parameters
	 * 
	 * @return BondPeriodGenerationParams object
	 */

	public org.drip.product.params.BondStream getPeriodGenParams()
	{
<span class="nc" id="L1581">		return org.drip.product.params.BondStream.Create (_dtMaturity.julian(),</span>
<span class="nc bnc" id="L1582" title="All 2 branches missed.">			_dtInterestAccrualStart.julian(), null == _dtFinalMaturity ? java.lang.Integer.MIN_VALUE :</span>
<span class="nc bnc" id="L1583" title="All 2 branches missed.">				_dtFinalMaturity.julian(), null == _dtFirstCoupon ? java.lang.Integer.MIN_VALUE :</span>
<span class="nc" id="L1584">					_dtFirstCoupon.julian(), _dtInterestAccrualStart.julian(), _iCouponFreq,</span>
						_dblCurrentCoupon, _strDayCountCode, _strDayCountCode, null, null, null, null, null,
							null, null, null, _strMaturityType, false, _strCouponCurrency,
<span class="nc bnc" id="L1587" title="All 2 branches missed.">								_strCouponCurrency, !org.drip.quant.common.StringUtil.IsEmpty (_strRateIndex)</span>
<span class="nc" id="L1588">									? org.drip.state.identifier.ForwardLabel.Standard (_strRateIndex) : null,</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">										!org.drip.quant.common.StringUtil.IsEmpty (_strIssuerSPN) ?</span>
<span class="nc" id="L1590">											org.drip.state.identifier.EntityCDSLabel.Standard (_strIssuerSPN,</span>
												_strCouponCurrency) : null);
	}

	/**
	 * Create an SQL Delete statement from the object's state
	 * 
	 * @return String representing the SQL Delete
	 */

	public java.lang.String makeSQLDelete()
	{
<span class="nc" id="L1602">		java.lang.StringBuilder sb = new java.lang.StringBuilder();</span>

<span class="nc" id="L1604">		sb.append (&quot;delete from BondValData where ISIN = '&quot;).append (_strISIN).append</span>
<span class="nc" id="L1605">			(&quot;' or CUSIP = '&quot;).append (_strCUSIP).append (&quot;'&quot;);</span>

<span class="nc" id="L1607">		return sb.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>