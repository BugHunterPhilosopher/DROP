<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FixedBondAPI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DROP</a> &gt; <a href="index.source.html" class="el_package">org.drip.service.product</a> &gt; <span class="el_source">FixedBondAPI.java</span></div><h1>FixedBondAPI.java</h1><pre class="source lang-java linenums">
package org.drip.service.product;

/*
 * -*- mode: java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 */

/*!
 * Copyright (C) 2018 Lakshmi Krishnamurthy
 * Copyright (C) 2017 Lakshmi Krishnamurthy
 * Copyright (C) 2016 Lakshmi Krishnamurthy
 * 
 *  This file is part of DRIP, a free-software/open-source library for buy/side financial/trading model
 *  	libraries targeting analysts and developers
 *  	https://lakshmidrip.github.io/DRIP/
 *  
 *  DRIP is composed of four main libraries:
 *  
 *  - DRIP Fixed Income - https://lakshmidrip.github.io/DRIP-Fixed-Income/
 *  - DRIP Asset Allocation - https://lakshmidrip.github.io/DRIP-Asset-Allocation/
 *  - DRIP Numerical Optimizer - https://lakshmidrip.github.io/DRIP-Numerical-Optimizer/
 *  - DRIP Statistical Learning - https://lakshmidrip.github.io/DRIP-Statistical-Learning/
 * 
 *  - DRIP Fixed Income: Library for Instrument/Trading Conventions, Treasury Futures/Options,
 *  	Funding/Forward/Overnight Curves, Multi-Curve Construction/Valuation, Collateral Valuation and XVA
 *  	Metric Generation, Calibration and Hedge Attributions, Statistical Curve Construction, Bond RV
 *  	Metrics, Stochastic Evolution and Option Pricing, Interest Rate Dynamics and Option Pricing, LMM
 *  	Extensions/Calibrations/Greeks, Algorithmic Differentiation, and Asset Backed Models and Analytics.
 * 
 *  - DRIP Asset Allocation: Library for model libraries for MPT framework, Black Litterman Strategy
 *  	Incorporator, Holdings Constraint, and Transaction Costs.
 * 
 *  - DRIP Numerical Optimizer: Library for Numerical Optimization and Spline Functionality.
 * 
 *  - DRIP Statistical Learning: Library for Statistical Evaluation and Machine Learning.
 * 
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   	you may not use this file except in compliance with the License.
 *   
 *  You may obtain a copy of the License at
 *  	http://www.apache.org/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  	distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  See the License for the specific language governing permissions and
 *  	limitations under the License.
 */

/**
 * BondAPI demonstrates the Details behind the Pricing and the Scenario Runs behind a Generic Bond.
 *
 * @author Lakshmi Krishnamurthy
 */

<span class="nc" id="L57">public class FixedBondAPI {</span>

	/**
	 * Generate a Full Map Invocation of the Bond Valuation Run
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param strBondMarketQuoteName Name of the Bond Market Quote
	 * @param dblBondMarketQuote Bond Market Quote Value
	 * 
	 * @return The Output Measure Map
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; ValuationMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final java.lang.String strBondMarketQuoteName,
		final double dblBondMarketQuote)
	{
<span class="fc" id="L128">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L129">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L130">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L131">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L132">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L137">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L139">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L141" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L142">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L144" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L145">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L148">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L152">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L154">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L156">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L158" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L159">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L162" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L163">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L166" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L168" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L169">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L172">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L175" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L178">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L179">			e.printStackTrace();</span>

<span class="nc" id="L181">			return null;</span>
<span class="fc" id="L182">		}</span>

<span class="fc" id="L184">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L185">			(strIssuerName + &quot; &quot; + org.drip.quant.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L189" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L191">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L194">			pmm.addQuote (strBondMarketQuoteName, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
				dblBondMarketQuote), true);
<span class="nc" id="L196">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L197">		}</span>

<span class="fc" id="L199">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L201">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L202">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L208">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L210">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L211">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L214">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L218">		return bond.value (org.drip.param.valuation.ValuationParams.Spot (iSpotDate), null, csqc, null);</span>
	}

	/**
	 * Generate the Treasury Curve Tenor Key Rate Sensitivity/Duration
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Govvie Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Treasury Curve Tenor Sensitivity/Duration
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; KeyRateDuration (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L262">		double dblBaselineOAS = java.lang.Double.NaN;</span>
<span class="fc" id="L263">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L264">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L265">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L266">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L267">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L270" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L272">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L274">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L276" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L277">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L279" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L280">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L283">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L287">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L289">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L291">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L293" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L294">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L297" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L298">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L301" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L303" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L304">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L307">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L310" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L313">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L314">			e.printStackTrace();</span>

<span class="nc" id="L316">			return null;</span>
<span class="fc" id="L317">		}</span>

<span class="fc" id="L319">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L320">			(strIssuerName + &quot; &quot; + org.drip.quant.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L324" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L326">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L329">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L331">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L332">			e.printStackTrace();</span>

<span class="nc" id="L334">			return null;</span>
<span class="fc" id="L335">		}</span>

<span class="fc" id="L337">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L339">		org.drip.state.govvie.GovvieCurve gc =</span>
<span class="fc" id="L340">			org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve (strGovvieCode,</span>
				dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure);

<span class="fc" id="L345">		csqc.setGovvieState (gc);</span>

<span class="fc" id="L347">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L348">			(iSpotDate);</span>

		try {
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">			if (!org.drip.quant.common.NumberUtil.IsValid (dblBaselineOAS = bond.oasFromPrice (valParams,</span>
				csqc, null, dblBondMarketCleanPrice)))
<span class="nc" id="L353">				return null;</span>
<span class="nc" id="L354">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L355">			e.printStackTrace();</span>

<span class="nc" id="L357">			return null;</span>
<span class="fc" id="L358">		}</span>

		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;org.drip.state.govvie.GovvieCurve&gt;
<span class="fc" id="L361">			mapTenorGovvieCurve = org.drip.service.template.LatentMarketStateBuilder.BumpedGovvieCurve</span>
<span class="fc" id="L362">				(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure,
							org.drip.service.template.LatentMarketStateBuilder.SHAPE_PRESERVING, 0.0001,
								false);

<span class="pc bpc" id="L368" title="2 of 4 branches missed.">		if (null == mapTenorGovvieCurve || iNumTreasuryBenchmark &gt; mapTenorGovvieCurve.size()) return null;</span>

<span class="fc" id="L370">		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt; mapKeyRateDuration = new</span>
			org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt;();

		for (java.util.Map.Entry&lt;java.lang.String, org.drip.state.govvie.GovvieCurve&gt; me :
<span class="fc bfc" id="L374" title="All 2 branches covered.">			mapTenorGovvieCurve.entrySet()) {</span>
<span class="fc" id="L375">			java.lang.String strKey = me.getKey();</span>

<span class="fc bfc" id="L377" title="All 2 branches covered.">			if (!strKey.contains (&quot;tsy&quot;)) continue;</span>

<span class="pc bpc" id="L379" title="1 of 2 branches missed.">			if (!csqc.setGovvieState (me.getValue())) return null;</span>

			try {
<span class="fc" id="L382">				mapKeyRateDuration.put (strKey, 10000. * (bond.priceFromOAS (valParams, csqc, null,</span>
					dblBaselineOAS) - dblBondMarketCleanPrice) / dblBondMarketCleanPrice);
<span class="nc" id="L384">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L385">				e.printStackTrace();</span>

<span class="nc" id="L387">				return null;</span>
<span class="fc" id="L388">			}</span>
<span class="fc" id="L389">		}</span>

<span class="fc" id="L391">		return mapKeyRateDuration;</span>
	}

	/**
	 * Returns Attribution for the Specified Bond Instance
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param adtSpot Array of Spot Dates
	 * @param adblCleanPrice Array of Closing Clean Prices
	 * 
	 * @return List of the Position Change Components
	 */

	public static final java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt;
		HorizonChangeAttribution (
			final java.lang.String strIssuerName,
			final int iBondEffectiveDate,
			final int iBondMaturityDate,
			final double dblBondCoupon,
			final int iBondCouponFrequency,
			final java.lang.String strBondCouponDayCount,
			final java.lang.String strBondCouponCurrency,
			final org.drip.analytics.date.JulianDate[] adtSpot,
			final double[] adblCleanPrice)
	{
<span class="nc" id="L422">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="nc" id="L423">		org.drip.analytics.date.JulianDate dtEffective = null;</span>

		try {
<span class="nc" id="L426">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="nc" id="L428">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>
<span class="nc" id="L429">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L430">			e.printStackTrace();</span>

<span class="nc" id="L432">			return null;</span>
<span class="nc" id="L433">		}</span>

<span class="nc" id="L435">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="nc" id="L436">			(strIssuerName + &quot; &quot; + org.drip.quant.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="nc bnc" id="L440" title="All 6 branches missed.">		if (null == bond || null == adtSpot || null == adblCleanPrice) return null;</span>

<span class="nc" id="L442">		int iNumCloses = adtSpot.length;</span>
<span class="nc" id="L443">		int[] aiSpotDate = new int[iNumCloses];</span>
<span class="nc" id="L444">		double[] adblYield = new double[iNumCloses];</span>
<span class="nc" id="L445">		double[] adblDirtyPrice = new double[iNumCloses];</span>
<span class="nc" id="L446">		double[] adblModifiedDuration = new double[iNumCloses];</span>

<span class="nc bnc" id="L448" title="All 4 branches missed.">		if (1 &gt;= iNumCloses || iNumCloses != adblCleanPrice.length) return null;</span>

<span class="nc bnc" id="L450" title="All 2 branches missed.">		for (int i = 0; i &lt; iNumCloses; ++i) {</span>
<span class="nc" id="L451">			org.drip.param.valuation.ValuationParams valParamsSpot =</span>
<span class="nc" id="L452">				org.drip.param.valuation.ValuationParams.Spot (aiSpotDate[i] = adtSpot[i].julian());</span>

			try {
<span class="nc bnc" id="L455" title="All 2 branches missed.">				if (!org.drip.quant.common.NumberUtil.IsValid (adblYield[i] = bond.yieldFromPrice</span>
<span class="nc" id="L456">					(valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L457">					return null;</span>

<span class="nc bnc" id="L459" title="All 2 branches missed.">				if (!org.drip.quant.common.NumberUtil.IsValid (adblModifiedDuration[i] =</span>
<span class="nc" id="L460">					bond.modifiedDurationFromPrice (valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L461">					return null;</span>

<span class="nc bnc" id="L463" title="All 2 branches missed.">				if (!org.drip.quant.common.NumberUtil.IsValid (adblDirtyPrice[i] = adblCleanPrice[i] +</span>
<span class="nc" id="L464">					bond.accrued (aiSpotDate[i], null)))</span>
<span class="nc" id="L465">					return null;</span>
<span class="nc" id="L466">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L467">				e.printStackTrace();</span>

<span class="nc" id="L469">				return null;</span>
<span class="nc" id="L470">			}</span>
		}

<span class="nc" id="L473">		java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt; lsPCC = new</span>
			java.util.ArrayList&lt;org.drip.historical.attribution.PositionChangeComponents&gt;();

<span class="nc bnc" id="L476" title="All 2 branches missed.">		for (int i = 1; i &lt; iNumCloses; ++i) {</span>
			try {
<span class="nc" id="L478">				org.drip.historical.attribution.BondMarketSnap bpms1 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i - 1],
						adblCleanPrice[i - 1]);

<span class="nc bnc" id="L482" title="All 2 branches missed.">				if (!bpms1.setYieldMarketFactor (adblYield[i - 1], -1. * adblDirtyPrice[i - 1] *</span>
					adblModifiedDuration[i - 1], 0.))
<span class="nc" id="L484">					return null;</span>

<span class="nc" id="L486">				org.drip.historical.attribution.BondMarketSnap bpms2 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i], adblCleanPrice[i]);

<span class="nc bnc" id="L489" title="All 2 branches missed.">				if (!bpms2.setYieldMarketFactor (adblYield[i], -1. * adblDirtyPrice[i] *</span>
					adblModifiedDuration[i], 0.))
<span class="nc" id="L491">					return null;</span>

<span class="nc" id="L493">				lsPCC.add (new org.drip.historical.attribution.PositionChangeComponents (false, bpms1, bpms2,</span>
<span class="nc" id="L494">					org.drip.analytics.daycount.Convention.YearFraction (aiSpotDate[i - 1],</span>
						aiSpotDate[i], strBondCouponDayCount, false, null, strBondCouponCurrency), null));
<span class="nc" id="L496">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L497">				e.printStackTrace();</span>

<span class="nc" id="L499">				return null;</span>
<span class="nc" id="L500">			}</span>
		}

<span class="nc" id="L503">		return lsPCC;</span>
	}

	/**
	 * Generate the Relative Value Metrics for the Specified Bond
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Relative Value Metrics
	 */

	public static final org.drip.analytics.output.BondRVMeasures RelativeValueMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L573">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L574">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L575">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L576">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L577">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L578" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L580" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L582">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L584">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L586" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L587">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L589" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L590">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L593">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L597">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L599">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L601">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L603" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L604">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L607" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L608">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L611" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L613" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L614">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L617">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L620" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L623">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L624">			e.printStackTrace();</span>

<span class="nc" id="L626">			return null;</span>
<span class="fc" id="L627">		}</span>

<span class="fc" id="L629">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L630">			(strIssuerName + &quot; &quot; + org.drip.quant.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L634" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L636">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L639">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L641">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L642">		}</span>

<span class="fc" id="L644">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L646">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L647">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L653">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L655">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L656">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L659">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L663">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L664">			(iSpotDate);</span>

<span class="fc" id="L666">		return bond.standardMeasures (valParams, null, csqc, null, bond.exerciseYieldFromPrice (valParams,</span>
			csqc, null, dblBondMarketCleanPrice), dblBondMarketCleanPrice);
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>