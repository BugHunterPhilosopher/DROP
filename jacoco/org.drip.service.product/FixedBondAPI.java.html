<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FixedBondAPI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DROP</a> &gt; <a href="index.source.html" class="el_package">org.drip.service.product</a> &gt; <span class="el_source">FixedBondAPI.java</span></div><h1>FixedBondAPI.java</h1><pre class="source lang-java linenums">
package org.drip.service.product;

/*
 * -*- mode: java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 */

/*!
 * Copyright (C) 2019 Lakshmi Krishnamurthy
 * Copyright (C) 2018 Lakshmi Krishnamurthy
 * Copyright (C) 2017 Lakshmi Krishnamurthy
 * Copyright (C) 2016 Lakshmi Krishnamurthy
 * 
 *  This file is part of DROP, an open-source library targeting risk, transaction costs, exposure, margin
 *  	calculations, and portfolio construction within and across fixed income, credit, commodity, equity,
 *  	FX, and structured products.
 *  
 *  	https://lakshmidrip.github.io/DROP/
 *  
 *  DROP is composed of three main modules:
 *  
 *  - DROP Analytics Core - https://lakshmidrip.github.io/DROP-Analytics-Core/
 *  - DROP Portfolio Core - https://lakshmidrip.github.io/DROP-Portfolio-Core/
 *  - DROP Numerical Core - https://lakshmidrip.github.io/DROP-Numerical-Core/
 * 
 * 	DROP Analytics Core implements libraries for the following:
 * 	- Fixed Income Analytics
 * 	- Asset Backed Analytics
 * 	- XVA Analytics
 * 	- Exposure and Margin Analytics
 * 
 * 	DROP Portfolio Core implements libraries for the following:
 * 	- Asset Allocation Analytics
 * 	- Transaction Cost Analytics
 * 
 * 	DROP Numerical Core implements libraries for the following:
 * 	- Statistical Learning Library
 * 	- Numerical Optimizer Library
 * 	- Machine Learning Library
 * 	- Spline Builder Library
 * 
 * 	Documentation for DROP is Spread Over:
 * 
 * 	- Main                     =&gt; https://lakshmidrip.github.io/DROP/
 * 	- Wiki                     =&gt; https://github.com/lakshmiDRIP/DROP/wiki
 * 	- GitHub                   =&gt; https://github.com/lakshmiDRIP/DROP
 * 	- Javadoc                  =&gt; https://lakshmidrip.github.io/DROP/Javadoc/index.html
 * 	- Technical Specifications =&gt; https://github.com/lakshmiDRIP/DROP/tree/master/Docs/Internal
 * 	- Release Versions         =&gt; https://lakshmidrip.github.io/DROP/version.html
 * 	- Community Credits        =&gt; https://lakshmidrip.github.io/DROP/credits.html
 * 	- Issues Catalog           =&gt; https://github.com/lakshmiDRIP/DROP/issues
 * 	- JUnit                    =&gt; https://lakshmidrip.github.io/DROP/junit/index.html
 * 	- Jacoco                   =&gt; https://lakshmidrip.github.io/DROP/jacoco/index.html
 * 
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   	you may not use this file except in compliance with the License.
 *   
 *  You may obtain a copy of the License at
 *  	http://www.apache.org/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  	distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  See the License for the specific language governing permissions and
 *  	limitations under the License.
 */

/**
 * &lt;i&gt;FixedBondAPI&lt;/i&gt; demonstrates the Details behind the Pricing and the Scenario Runs behind a Fixed Bond.
 * 
 * &lt;br&gt;&lt;br&gt;
 *  &lt;ul&gt;
 *		&lt;li&gt;&lt;b&gt;Module &lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/NumericalCore.md&quot;&gt;Numerical Core Module&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Library&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/AlgorithmSupportLibrary.md&quot;&gt;Algorithm Support Library&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Project&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/src/main/java/org/drip/service&quot;&gt;Service&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Package&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/src/main/java/org/drip/service/product&quot;&gt;Product API&lt;/a&gt;&lt;/li&gt;
 *  &lt;/ul&gt;
 * &lt;br&gt;&lt;br&gt;
 *
 * @author Lakshmi Krishnamurthy
 */

<span class="nc" id="L84">public class FixedBondAPI {</span>

	/**
	 * Generate a Full Map Invocation of the Bond Valuation Run
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param strBondMarketQuoteName Name of the Bond Market Quote
	 * @param dblBondMarketQuote Bond Market Quote Value
	 * 
	 * @return The Output Measure Map
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; ValuationMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final java.lang.String strBondMarketQuoteName,
		final double dblBondMarketQuote)
	{
<span class="fc" id="L155">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L156">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L157">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L158">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L159">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L164">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L166">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L168" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L169">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L171" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L172">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L175">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L179">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L181">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L183">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L185" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L186">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L189" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L190">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L193" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L195" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L196">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L199">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L202" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L205">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L206">			e.printStackTrace();</span>

<span class="nc" id="L208">			return null;</span>
<span class="fc" id="L209">		}</span>

<span class="fc" id="L211">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L212">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L216" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L218">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L221">			pmm.addQuote (strBondMarketQuoteName, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
				dblBondMarketQuote), true);
<span class="nc" id="L223">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L224">		}</span>

<span class="fc" id="L226">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L228">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L229">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L235">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L237">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L238">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L241">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L245">		return bond.value (org.drip.param.valuation.ValuationParams.Spot (iSpotDate), null, csqc, null);</span>
	}

	/**
	 * Generate the Treasury Curve Tenor Key Rate Sensitivity/Duration
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Govvie Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Treasury Curve Tenor Sensitivity/Duration
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; KeyRateDuration (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L289">		double dblBaselineOAS = java.lang.Double.NaN;</span>
<span class="fc" id="L290">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L291">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L292">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L293">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L294">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L297" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L299">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L301">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L303" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L304">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L306" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L307">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L310">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L314">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L316">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L318">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L320" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L321">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L324" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L325">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L328" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L330" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L331">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L334">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L337" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L340">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L341">			e.printStackTrace();</span>

<span class="nc" id="L343">			return null;</span>
<span class="fc" id="L344">		}</span>

<span class="fc" id="L346">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L347">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L351" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L353">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L356">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L358">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L359">			e.printStackTrace();</span>

<span class="nc" id="L361">			return null;</span>
<span class="fc" id="L362">		}</span>

<span class="fc" id="L364">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L366">		org.drip.state.govvie.GovvieCurve gc =</span>
<span class="fc" id="L367">			org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve (strGovvieCode,</span>
				dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure);

<span class="fc" id="L372">		csqc.setGovvieState (gc);</span>

<span class="fc" id="L374">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L375">			(iSpotDate);</span>

		try {
<span class="pc bpc" id="L378" title="1 of 2 branches missed.">			if (!org.drip.numerical.common.NumberUtil.IsValid (dblBaselineOAS = bond.oasFromPrice (valParams,</span>
				csqc, null, dblBondMarketCleanPrice)))
<span class="nc" id="L380">				return null;</span>
<span class="nc" id="L381">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L382">			e.printStackTrace();</span>

<span class="nc" id="L384">			return null;</span>
<span class="fc" id="L385">		}</span>

		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;org.drip.state.govvie.GovvieCurve&gt;
<span class="fc" id="L388">			mapTenorGovvieCurve = org.drip.service.template.LatentMarketStateBuilder.BumpedGovvieCurve</span>
<span class="fc" id="L389">				(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure,
							org.drip.service.template.LatentMarketStateBuilder.SHAPE_PRESERVING, 0.0001,
								false);

<span class="pc bpc" id="L395" title="2 of 4 branches missed.">		if (null == mapTenorGovvieCurve || iNumTreasuryBenchmark &gt; mapTenorGovvieCurve.size()) return null;</span>

<span class="fc" id="L397">		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt; mapKeyRateDuration = new</span>
			org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt;();

		for (java.util.Map.Entry&lt;java.lang.String, org.drip.state.govvie.GovvieCurve&gt; me :
<span class="fc bfc" id="L401" title="All 2 branches covered.">			mapTenorGovvieCurve.entrySet()) {</span>
<span class="fc" id="L402">			java.lang.String strKey = me.getKey();</span>

<span class="fc bfc" id="L404" title="All 2 branches covered.">			if (!strKey.contains (&quot;tsy&quot;)) continue;</span>

<span class="pc bpc" id="L406" title="1 of 2 branches missed.">			if (!csqc.setGovvieState (me.getValue())) return null;</span>

			try {
<span class="fc" id="L409">				mapKeyRateDuration.put (strKey, 10000. * (bond.priceFromOAS (valParams, csqc, null,</span>
					dblBaselineOAS) - dblBondMarketCleanPrice) / dblBondMarketCleanPrice);
<span class="nc" id="L411">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L412">				e.printStackTrace();</span>

<span class="nc" id="L414">				return null;</span>
<span class="fc" id="L415">			}</span>
<span class="fc" id="L416">		}</span>

<span class="fc" id="L418">		return mapKeyRateDuration;</span>
	}

	/**
	 * Returns Attribution for the Specified Bond Instance
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param adtSpot Array of Spot Dates
	 * @param adblCleanPrice Array of Closing Clean Prices
	 * 
	 * @return List of the Position Change Components
	 */

	public static final java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt;
		HorizonChangeAttribution (
			final java.lang.String strIssuerName,
			final int iBondEffectiveDate,
			final int iBondMaturityDate,
			final double dblBondCoupon,
			final int iBondCouponFrequency,
			final java.lang.String strBondCouponDayCount,
			final java.lang.String strBondCouponCurrency,
			final org.drip.analytics.date.JulianDate[] adtSpot,
			final double[] adblCleanPrice)
	{
<span class="nc" id="L449">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="nc" id="L450">		org.drip.analytics.date.JulianDate dtEffective = null;</span>

		try {
<span class="nc" id="L453">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="nc" id="L455">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>
<span class="nc" id="L456">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L457">			e.printStackTrace();</span>

<span class="nc" id="L459">			return null;</span>
<span class="nc" id="L460">		}</span>

<span class="nc" id="L462">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="nc" id="L463">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="nc bnc" id="L467" title="All 6 branches missed.">		if (null == bond || null == adtSpot || null == adblCleanPrice) return null;</span>

<span class="nc" id="L469">		int iNumCloses = adtSpot.length;</span>
<span class="nc" id="L470">		int[] aiSpotDate = new int[iNumCloses];</span>
<span class="nc" id="L471">		double[] adblYield = new double[iNumCloses];</span>
<span class="nc" id="L472">		double[] adblDirtyPrice = new double[iNumCloses];</span>
<span class="nc" id="L473">		double[] adblModifiedDuration = new double[iNumCloses];</span>

<span class="nc bnc" id="L475" title="All 4 branches missed.">		if (1 &gt;= iNumCloses || iNumCloses != adblCleanPrice.length) return null;</span>

<span class="nc bnc" id="L477" title="All 2 branches missed.">		for (int i = 0; i &lt; iNumCloses; ++i) {</span>
<span class="nc" id="L478">			org.drip.param.valuation.ValuationParams valParamsSpot =</span>
<span class="nc" id="L479">				org.drip.param.valuation.ValuationParams.Spot (aiSpotDate[i] = adtSpot[i].julian());</span>

			try {
<span class="nc bnc" id="L482" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblYield[i] = bond.yieldFromPrice</span>
<span class="nc" id="L483">					(valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L484">					return null;</span>

<span class="nc bnc" id="L486" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblModifiedDuration[i] =</span>
<span class="nc" id="L487">					bond.modifiedDurationFromPrice (valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L488">					return null;</span>

<span class="nc bnc" id="L490" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblDirtyPrice[i] = adblCleanPrice[i] +</span>
<span class="nc" id="L491">					bond.accrued (aiSpotDate[i], null)))</span>
<span class="nc" id="L492">					return null;</span>
<span class="nc" id="L493">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L494">				e.printStackTrace();</span>

<span class="nc" id="L496">				return null;</span>
<span class="nc" id="L497">			}</span>
		}

<span class="nc" id="L500">		java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt; lsPCC = new</span>
			java.util.ArrayList&lt;org.drip.historical.attribution.PositionChangeComponents&gt;();

<span class="nc bnc" id="L503" title="All 2 branches missed.">		for (int i = 1; i &lt; iNumCloses; ++i) {</span>
			try {
<span class="nc" id="L505">				org.drip.historical.attribution.BondMarketSnap bpms1 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i - 1],
						adblCleanPrice[i - 1]);

<span class="nc bnc" id="L509" title="All 2 branches missed.">				if (!bpms1.setYieldMarketFactor (adblYield[i - 1], -1. * adblDirtyPrice[i - 1] *</span>
					adblModifiedDuration[i - 1], 0.))
<span class="nc" id="L511">					return null;</span>

<span class="nc" id="L513">				org.drip.historical.attribution.BondMarketSnap bpms2 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i], adblCleanPrice[i]);

<span class="nc bnc" id="L516" title="All 2 branches missed.">				if (!bpms2.setYieldMarketFactor (adblYield[i], -1. * adblDirtyPrice[i] *</span>
					adblModifiedDuration[i], 0.))
<span class="nc" id="L518">					return null;</span>

<span class="nc" id="L520">				lsPCC.add (new org.drip.historical.attribution.PositionChangeComponents (false, bpms1, bpms2,</span>
<span class="nc" id="L521">					org.drip.analytics.daycount.Convention.YearFraction (aiSpotDate[i - 1],</span>
						aiSpotDate[i], strBondCouponDayCount, false, null, strBondCouponCurrency), null));
<span class="nc" id="L523">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L524">				e.printStackTrace();</span>

<span class="nc" id="L526">				return null;</span>
<span class="nc" id="L527">			}</span>
		}

<span class="nc" id="L530">		return lsPCC;</span>
	}

	/**
	 * Generate the Relative Value Metrics for the Specified Bond
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Relative Value Metrics
	 */

	public static final org.drip.analytics.output.BondRVMeasures RelativeValueMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L600">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L601">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L602">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L603">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L604">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L605" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L607" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L609">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L611">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L613" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L614">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L616" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L617">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L620">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L624">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L626">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L628">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L630" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L631">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L634" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L635">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L638" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L640" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L641">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L644">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L647" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L650">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L651">			e.printStackTrace();</span>

<span class="nc" id="L653">			return null;</span>
<span class="fc" id="L654">		}</span>

<span class="fc" id="L656">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L657">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L661" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L663">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L666">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L668">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L669">		}</span>

<span class="fc" id="L671">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L673">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L674">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L680">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L682">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L683">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L686">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L690">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L691">			(iSpotDate);</span>

<span class="fc" id="L693">		return bond.standardMeasures (valParams, null, csqc, null, bond.exerciseYieldFromPrice (valParams,</span>
			csqc, null, dblBondMarketCleanPrice), dblBondMarketCleanPrice);
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>