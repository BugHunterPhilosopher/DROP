<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FixedBondAPI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DROP</a> &gt; <a href="index.source.html" class="el_package">org.drip.service.product</a> &gt; <span class="el_source">FixedBondAPI.java</span></div><h1>FixedBondAPI.java</h1><pre class="source lang-java linenums">
package org.drip.service.product;

/*
 * -*- mode: java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 */

/*!
 * Copyright (C) 2020 Lakshmi Krishnamurthy
 * Copyright (C) 2019 Lakshmi Krishnamurthy
 * Copyright (C) 2018 Lakshmi Krishnamurthy
 * Copyright (C) 2017 Lakshmi Krishnamurthy
 * Copyright (C) 2016 Lakshmi Krishnamurthy
 * 
 *  This file is part of DROP, an open-source library targeting analytics/risk, transaction cost analytics,
 *  	asset liability management analytics, capital, exposure, and margin analytics, valuation adjustment
 *  	analytics, and portfolio construction analytics within and across fixed income, credit, commodity,
 *  	equity, FX, and structured products. It also includes auxiliary libraries for algorithm support,
 *  	numerical analysis, numerical optimization, spline builder, model validation, statistical learning,
 *  	and computational support.
 *  
 *  	https://lakshmidrip.github.io/DROP/
 *  
 *  DROP is composed of three modules:
 *  
 *  - DROP Product Core - https://lakshmidrip.github.io/DROP-Product-Core/
 *  - DROP Portfolio Core - https://lakshmidrip.github.io/DROP-Portfolio-Core/
 *  - DROP Computational Core - https://lakshmidrip.github.io/DROP-Computational-Core/
 * 
 * 	DROP Product Core implements libraries for the following:
 * 	- Fixed Income Analytics
 * 	- Loan Analytics
 * 	- Transaction Cost Analytics
 * 
 * 	DROP Portfolio Core implements libraries for the following:
 * 	- Asset Allocation Analytics
 *  - Asset Liability Management Analytics
 * 	- Capital Estimation Analytics
 * 	- Exposure Analytics
 * 	- Margin Analytics
 * 	- XVA Analytics
 * 
 * 	DROP Computational Core implements libraries for the following:
 * 	- Algorithm Support
 * 	- Computation Support
 * 	- Function Analysis
 *  - Model Validation
 * 	- Numerical Analysis
 * 	- Numerical Optimizer
 * 	- Spline Builder
 *  - Statistical Learning
 * 
 * 	Documentation for DROP is Spread Over:
 * 
 * 	- Main                     =&gt; https://lakshmidrip.github.io/DROP/
 * 	- Wiki                     =&gt; https://github.com/lakshmiDRIP/DROP/wiki
 * 	- GitHub                   =&gt; https://github.com/lakshmiDRIP/DROP
 * 	- Repo Layout Taxonomy     =&gt; https://github.com/lakshmiDRIP/DROP/blob/master/Taxonomy.md
 * 	- Javadoc                  =&gt; https://lakshmidrip.github.io/DROP/Javadoc/index.html
 * 	- Technical Specifications =&gt; https://github.com/lakshmiDRIP/DROP/tree/master/Docs/Internal
 * 	- Release Versions         =&gt; https://lakshmidrip.github.io/DROP/version.html
 * 	- Community Credits        =&gt; https://lakshmidrip.github.io/DROP/credits.html
 * 	- Issues Catalog           =&gt; https://github.com/lakshmiDRIP/DROP/issues
 * 	- JUnit                    =&gt; https://lakshmidrip.github.io/DROP/junit/index.html
 * 	- Jacoco                   =&gt; https://lakshmidrip.github.io/DROP/jacoco/index.html
 * 
 *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   	you may not use this file except in compliance with the License.
 *   
 *  You may obtain a copy of the License at
 *  	http://www.apache.org/licenses/LICENSE-2.0
 *  
 *  Unless required by applicable law or agreed to in writing, software
 *  	distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  
 *  See the License for the specific language governing permissions and
 *  	limitations under the License.
 */

/**
 * &lt;i&gt;FixedBondAPI&lt;/i&gt; demonstrates the Details behind the Pricing and the Scenario Runs behind a Fixed Bond.
 * 
 * &lt;br&gt;&lt;br&gt;
 *  &lt;ul&gt;
 *		&lt;li&gt;&lt;b&gt;Module &lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/ComputationalCore.md&quot;&gt;Computational Core Module&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Library&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/ComputationSupportLibrary.md&quot;&gt;Computation Support&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Project&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/src/main/java/org/drip/service/README.md&quot;&gt;Environment, Product/Definition Containers, and Scenario/State Manipulation APIs&lt;/a&gt;&lt;/li&gt;
 *		&lt;li&gt;&lt;b&gt;Package&lt;/b&gt; = &lt;a href = &quot;https://github.com/lakshmiDRIP/DROP/tree/master/src/main/java/org/drip/service/product/README.md&quot;&gt;Product Horizon PnL Attribution Decomposition&lt;/a&gt;&lt;/li&gt;
 *  &lt;/ul&gt;
 * &lt;br&gt;&lt;br&gt;
 *
 * @author Lakshmi Krishnamurthy
 */

<span class="nc" id="L96">public class FixedBondAPI {</span>

	/**
	 * Generate a Full Map Invocation of the Bond Valuation Run
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param strBondMarketQuoteName Name of the Bond Market Quote
	 * @param dblBondMarketQuote Bond Market Quote Value
	 * 
	 * @return The Output Measure Map
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; ValuationMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final java.lang.String strBondMarketQuoteName,
		final double dblBondMarketQuote)
	{
<span class="fc" id="L167">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L168">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L169">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L170">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L171">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L174" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L176">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L178">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L180" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L181">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L183" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L184">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L187">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L191">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L193">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L195">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L197" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L198">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L201" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L202">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L205" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L207" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L208">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L211">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L214" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L217">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L218">			e.printStackTrace();</span>

<span class="nc" id="L220">			return null;</span>
<span class="fc" id="L221">		}</span>

<span class="fc" id="L223">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L224">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L228" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L230">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L233">			pmm.addQuote (strBondMarketQuoteName, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
				dblBondMarketQuote), true);
<span class="nc" id="L235">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L236">		}</span>

<span class="fc" id="L238">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L240">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L241">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L247">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L249">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L250">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L253">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L257">		return bond.value (org.drip.param.valuation.ValuationParams.Spot (iSpotDate), null, csqc, null);</span>
	}

	/**
	 * Generate the Treasury Curve Tenor Key Rate Sensitivity/Duration
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Govvie Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Treasury Curve Tenor Sensitivity/Duration
	 */

	public static final java.util.Map&lt;java.lang.String, java.lang.Double&gt; KeyRateDuration (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L301">		double dblBaselineOAS = java.lang.Double.NaN;</span>
<span class="fc" id="L302">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L303">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L304">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L305">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L306">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L311">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L313">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L315" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L316">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L318" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L319">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L322">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L326">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L328">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L330">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L332" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L333">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L336" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L337">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L340" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L342" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L343">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L346">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L349" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L352">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L353">			e.printStackTrace();</span>

<span class="nc" id="L355">			return null;</span>
<span class="fc" id="L356">		}</span>

<span class="fc" id="L358">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L359">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L363" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L365">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L368">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L370">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L371">			e.printStackTrace();</span>

<span class="nc" id="L373">			return null;</span>
<span class="fc" id="L374">		}</span>

<span class="fc" id="L376">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L378">		org.drip.state.govvie.GovvieCurve gc =</span>
<span class="fc" id="L379">			org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve (strGovvieCode,</span>
				dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure);

<span class="fc" id="L384">		csqc.setGovvieState (gc);</span>

<span class="fc" id="L386">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L387">			(iSpotDate);</span>

		try {
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">			if (!org.drip.numerical.common.NumberUtil.IsValid (dblBaselineOAS = bond.oasFromPrice (valParams,</span>
				csqc, null, dblBondMarketCleanPrice)))
<span class="nc" id="L392">				return null;</span>
<span class="nc" id="L393">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L394">			e.printStackTrace();</span>

<span class="nc" id="L396">			return null;</span>
<span class="fc" id="L397">		}</span>

		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;org.drip.state.govvie.GovvieCurve&gt;
<span class="fc" id="L400">			mapTenorGovvieCurve = org.drip.service.template.LatentMarketStateBuilder.BumpedGovvieCurve</span>
<span class="fc" id="L401">				(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
					adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield,
						strGovvieCurveTreasuryMeasure,
							org.drip.service.template.LatentMarketStateBuilder.SHAPE_PRESERVING, 0.0001,
								false);

<span class="pc bpc" id="L407" title="2 of 4 branches missed.">		if (null == mapTenorGovvieCurve || iNumTreasuryBenchmark &gt; mapTenorGovvieCurve.size()) return null;</span>

<span class="fc" id="L409">		org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt; mapKeyRateDuration = new</span>
			org.drip.analytics.support.CaseInsensitiveTreeMap&lt;java.lang.Double&gt;();

		for (java.util.Map.Entry&lt;java.lang.String, org.drip.state.govvie.GovvieCurve&gt; me :
<span class="fc bfc" id="L413" title="All 2 branches covered.">			mapTenorGovvieCurve.entrySet()) {</span>
<span class="fc" id="L414">			java.lang.String strKey = me.getKey();</span>

<span class="fc bfc" id="L416" title="All 2 branches covered.">			if (!strKey.contains (&quot;tsy&quot;)) continue;</span>

<span class="pc bpc" id="L418" title="1 of 2 branches missed.">			if (!csqc.setGovvieState (me.getValue())) return null;</span>

			try {
<span class="fc" id="L421">				mapKeyRateDuration.put (strKey, 10000. * (bond.priceFromOAS (valParams, csqc, null,</span>
					dblBaselineOAS) - dblBondMarketCleanPrice) / dblBondMarketCleanPrice);
<span class="nc" id="L423">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L424">				e.printStackTrace();</span>

<span class="nc" id="L426">				return null;</span>
<span class="fc" id="L427">			}</span>
<span class="fc" id="L428">		}</span>

<span class="fc" id="L430">		return mapKeyRateDuration;</span>
	}

	/**
	 * Returns Attribution for the Specified Bond Instance
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param adtSpot Array of Spot Dates
	 * @param adblCleanPrice Array of Closing Clean Prices
	 * 
	 * @return List of the Position Change Components
	 */

	public static final java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt;
		HorizonChangeAttribution (
			final java.lang.String strIssuerName,
			final int iBondEffectiveDate,
			final int iBondMaturityDate,
			final double dblBondCoupon,
			final int iBondCouponFrequency,
			final java.lang.String strBondCouponDayCount,
			final java.lang.String strBondCouponCurrency,
			final org.drip.analytics.date.JulianDate[] adtSpot,
			final double[] adblCleanPrice)
	{
<span class="nc" id="L461">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="nc" id="L462">		org.drip.analytics.date.JulianDate dtEffective = null;</span>

		try {
<span class="nc" id="L465">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="nc" id="L467">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>
<span class="nc" id="L468">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L469">			e.printStackTrace();</span>

<span class="nc" id="L471">			return null;</span>
<span class="nc" id="L472">		}</span>

<span class="nc" id="L474">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="nc" id="L475">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="nc bnc" id="L479" title="All 6 branches missed.">		if (null == bond || null == adtSpot || null == adblCleanPrice) return null;</span>

<span class="nc" id="L481">		int iNumCloses = adtSpot.length;</span>
<span class="nc" id="L482">		int[] aiSpotDate = new int[iNumCloses];</span>
<span class="nc" id="L483">		double[] adblYield = new double[iNumCloses];</span>
<span class="nc" id="L484">		double[] adblDirtyPrice = new double[iNumCloses];</span>
<span class="nc" id="L485">		double[] adblModifiedDuration = new double[iNumCloses];</span>

<span class="nc bnc" id="L487" title="All 4 branches missed.">		if (1 &gt;= iNumCloses || iNumCloses != adblCleanPrice.length) return null;</span>

<span class="nc bnc" id="L489" title="All 2 branches missed.">		for (int i = 0; i &lt; iNumCloses; ++i) {</span>
<span class="nc" id="L490">			org.drip.param.valuation.ValuationParams valParamsSpot =</span>
<span class="nc" id="L491">				org.drip.param.valuation.ValuationParams.Spot (aiSpotDate[i] = adtSpot[i].julian());</span>

			try {
<span class="nc bnc" id="L494" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblYield[i] = bond.yieldFromPrice</span>
<span class="nc" id="L495">					(valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L496">					return null;</span>

<span class="nc bnc" id="L498" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblModifiedDuration[i] =</span>
<span class="nc" id="L499">					bond.modifiedDurationFromPrice (valParamsSpot, null, null, adblCleanPrice[i])))</span>
<span class="nc" id="L500">					return null;</span>

<span class="nc bnc" id="L502" title="All 2 branches missed.">				if (!org.drip.numerical.common.NumberUtil.IsValid (adblDirtyPrice[i] = adblCleanPrice[i] +</span>
<span class="nc" id="L503">					bond.accrued (aiSpotDate[i], null)))</span>
<span class="nc" id="L504">					return null;</span>
<span class="nc" id="L505">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L506">				e.printStackTrace();</span>

<span class="nc" id="L508">				return null;</span>
<span class="nc" id="L509">			}</span>
		}

<span class="nc" id="L512">		java.util.List&lt;org.drip.historical.attribution.PositionChangeComponents&gt; lsPCC = new</span>
			java.util.ArrayList&lt;org.drip.historical.attribution.PositionChangeComponents&gt;();

<span class="nc bnc" id="L515" title="All 2 branches missed.">		for (int i = 1; i &lt; iNumCloses; ++i) {</span>
			try {
<span class="nc" id="L517">				org.drip.historical.attribution.BondMarketSnap bpms1 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i - 1],
						adblCleanPrice[i - 1]);

<span class="nc bnc" id="L521" title="All 2 branches missed.">				if (!bpms1.setYieldMarketFactor (adblYield[i - 1], -1. * adblDirtyPrice[i - 1] *</span>
					adblModifiedDuration[i - 1], 0.))
<span class="nc" id="L523">					return null;</span>

<span class="nc" id="L525">				org.drip.historical.attribution.BondMarketSnap bpms2 = new</span>
					org.drip.historical.attribution.BondMarketSnap (adtSpot[i], adblCleanPrice[i]);

<span class="nc bnc" id="L528" title="All 2 branches missed.">				if (!bpms2.setYieldMarketFactor (adblYield[i], -1. * adblDirtyPrice[i] *</span>
					adblModifiedDuration[i], 0.))
<span class="nc" id="L530">					return null;</span>

<span class="nc" id="L532">				lsPCC.add (new org.drip.historical.attribution.PositionChangeComponents (false, bpms1, bpms2,</span>
<span class="nc" id="L533">					org.drip.analytics.daycount.Convention.YearFraction (aiSpotDate[i - 1],</span>
						aiSpotDate[i], strBondCouponDayCount, false, null, strBondCouponCurrency), null));
<span class="nc" id="L535">			} catch (java.lang.Exception e) {</span>
<span class="nc" id="L536">				e.printStackTrace();</span>

<span class="nc" id="L538">				return null;</span>
<span class="nc" id="L539">			}</span>
		}

<span class="nc" id="L542">		return lsPCC;</span>
	}

	/**
	 * Generate the Relative Value Metrics for the Specified Bond
	 * 
	 * @param strIssuerName Bond Issuer Name
	 * @param iBondEffectiveDate Bond Effective Date
	 * @param iBondMaturityDate Bond Maturity Date
	 * @param dblBondCoupon Bond Coupon
	 * @param iBondCouponFrequency Bond Coupon Frequency
	 * @param strBondCouponDayCount Bond Coupon Day Count
	 * @param strBondCouponCurrency Bond Coupon Currency
	 * @param iSpotDate Spot Date
	 * @param astrFundingCurveDepositTenor Deposit Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveDepositQuote Deposit Instruments Quote (for Funding Curve)
	 * @param strFundingCurveDepositMeasure Deposit Instruments Measure (for Funding Curve)
	 * @param adblFundingCurveFuturesQuote Futures Instruments Tenor (for Funding Curve)
	 * @param strFundingCurveFuturesMeasure Futures Instruments Measure (for Funding Curve)
	 * @param astrFundingCurveFixFloatTenor Fix-Float Instruments Tenor (for Funding Curve)
	 * @param adblFundingCurveFixFloatQuote Fix-Float Instruments Quote (for Funding Curve)
	 * @param strFundingFixFloatMeasure Fix-Float Instruments Tenor (for Funding Curve)
	 * @param strGovvieCode Govvie Bond Code (for Treasury Curve)
	 * @param aiGovvieCurveTreasuryEffectiveDate Array of the Treasury Instrument Effective Date (for Treasury
	 * 		Curve)
	 * @param aiGovvieCurveTreasuryMaturityDate Array of the Treasury Instrument Maturity Date (for Treasury
	 * 		Curve)
	 * @param adblGovvieCurveTreasuryCoupon Array of the Treasury Instrument Coupon (for Treasury Curve)
	 * @param adblGovvieCurveTreasuryYield Array of the Treasury Instrument Yield (for Treasury Curve)
	 * @param strGovvieCurveTreasuryMeasure Treasury Instrument Measure (for Treasury Curve)
	 * @param strCreditCurveName Credit Curve Name (for Credit Curve)
	 * @param astrCreditCurveCDSTenor CDS Maturity Tenor (for Credit Curve)
	 * @param adblCreditCurveCDSCoupon Array of CDS Fixed Coupon (for Credit Curve)
	 * @param adblCreditCurveCDSQuote Array of CDS Market Quotes (for Credit Curve)
	 * @param strCreditCurveCDSMeasure CDS Calibration Measure (for Credit Curve)
	 * @param dblBondMarketCleanPrice Bond Market Clean Price
	 * 
	 * @return The Relative Value Metrics
	 */

	public static final org.drip.analytics.output.BondRVMeasures RelativeValueMetrics (
		final java.lang.String strIssuerName,
		final int iBondEffectiveDate,
		final int iBondMaturityDate,
		final double dblBondCoupon,
		final int iBondCouponFrequency,
		final java.lang.String strBondCouponDayCount,
		final java.lang.String strBondCouponCurrency,
		final int iSpotDate,
		final java.lang.String[] astrFundingCurveDepositTenor,
		final double[] adblFundingCurveDepositQuote,
		final java.lang.String strFundingCurveDepositMeasure,
		final double[] adblFundingCurveFuturesQuote,
		final java.lang.String strFundingCurveFuturesMeasure,
		final java.lang.String[] astrFundingCurveFixFloatTenor,
		final double[] adblFundingCurveFixFloatQuote,
		final java.lang.String strFundingFixFloatMeasure,
		final java.lang.String strGovvieCode,
		final int[] aiGovvieCurveTreasuryEffectiveDate,
		final int[] aiGovvieCurveTreasuryMaturityDate,
		final double[] adblGovvieCurveTreasuryCoupon,
		final double[] adblGovvieCurveTreasuryYield,
		final java.lang.String strGovvieCurveTreasuryMeasure,
		final java.lang.String strCreditCurveName,
		final java.lang.String[] astrCreditCurveCDSTenor,
		final double[] adblCreditCurveCDSCoupon,
		final double[] adblCreditCurveCDSQuote,
		final java.lang.String strCreditCurveCDSMeasure,
		final double dblBondMarketCleanPrice)
	{
<span class="fc" id="L612">		org.drip.analytics.date.JulianDate dtSpot = null;</span>
<span class="fc" id="L613">		org.drip.analytics.date.JulianDate dtMaturity = null;</span>
<span class="fc" id="L614">		org.drip.analytics.date.JulianDate dtEffective = null;</span>
<span class="fc" id="L615">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryMaturity = null;</span>
<span class="fc" id="L616">		org.drip.analytics.date.JulianDate[] adtGovvieCurveTreasuryEffective = null;</span>
<span class="pc bpc" id="L617" title="1 of 2 branches missed.">		int iNumGovvieCurveMaturity = null == aiGovvieCurveTreasuryMaturityDate ? 0 :</span>
			aiGovvieCurveTreasuryMaturityDate.length;
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">		int iNumGovvieCurveEffective = null == aiGovvieCurveTreasuryEffectiveDate ? 0 :</span>
			aiGovvieCurveTreasuryEffectiveDate.length;
<span class="fc" id="L621">		java.lang.String[] astrTreasuryBenchmarkCode = new java.lang.String[] {&quot;01YON&quot;, &quot;02YON&quot;, &quot;03YON&quot;,</span>
			&quot;05YON&quot;, &quot;07YON&quot;, &quot;10YON&quot;, &quot;30YON&quot;};
<span class="fc" id="L623">		int iNumTreasuryBenchmark = astrTreasuryBenchmarkCode.length;</span>

<span class="pc bpc" id="L625" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveMaturity)</span>
<span class="fc" id="L626">			adtGovvieCurveTreasuryMaturity = new org.drip.analytics.date.JulianDate[iNumGovvieCurveMaturity];</span>

<span class="pc bpc" id="L628" title="1 of 2 branches missed.">		if (0 != iNumGovvieCurveEffective)</span>
<span class="fc" id="L629">			adtGovvieCurveTreasuryEffective = new</span>
				org.drip.analytics.date.JulianDate[iNumGovvieCurveEffective];

<span class="fc" id="L632">		org.drip.param.market.CurveSurfaceQuoteContainer csqc = new</span>
			org.drip.param.market.CurveSurfaceQuoteContainer();

		try {
<span class="fc" id="L636">			dtSpot = new org.drip.analytics.date.JulianDate (iSpotDate);</span>

<span class="fc" id="L638">			dtMaturity = new org.drip.analytics.date.JulianDate (iBondMaturityDate);</span>

<span class="fc" id="L640">			dtEffective = new org.drip.analytics.date.JulianDate (iBondEffectiveDate);</span>

<span class="fc bfc" id="L642" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveMaturity; ++i)</span>
<span class="fc" id="L643">				adtGovvieCurveTreasuryMaturity[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryMaturityDate[i]);

<span class="fc bfc" id="L646" title="All 2 branches covered.">			for (int i = 0; i &lt; iNumGovvieCurveEffective; ++i)</span>
<span class="fc" id="L647">				adtGovvieCurveTreasuryEffective[i] = new org.drip.analytics.date.JulianDate</span>
					(aiGovvieCurveTreasuryEffectiveDate[i]);

<span class="pc bpc" id="L650" title="2 of 4 branches missed.">			if (null != adblGovvieCurveTreasuryYield &amp;&amp; adblGovvieCurveTreasuryYield.length ==</span>
				iNumTreasuryBenchmark) {
<span class="fc bfc" id="L652" title="All 2 branches covered.">				for (int i = 0; i &lt; iNumTreasuryBenchmark; ++i) {</span>
<span class="fc" id="L653">					org.drip.param.quote.ProductMultiMeasure pmm = new</span>
						org.drip.param.quote.ProductMultiMeasure();

<span class="fc" id="L656">					pmm.addQuote (&quot;Yield&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;,</span>
						adblGovvieCurveTreasuryYield[i]), true);

<span class="pc bpc" id="L659" title="1 of 2 branches missed.">					if (!csqc.setProductQuote (astrTreasuryBenchmarkCode[i], pmm)) return null;</span>
				}
			}
<span class="nc" id="L662">		} catch (java.lang.Exception e) {</span>
<span class="nc" id="L663">			e.printStackTrace();</span>

<span class="nc" id="L665">			return null;</span>
<span class="fc" id="L666">		}</span>

<span class="fc" id="L668">		org.drip.product.credit.BondComponent bond = org.drip.product.creator.BondBuilder.CreateSimpleFixed</span>
<span class="fc" id="L669">			(strIssuerName + &quot; &quot; + org.drip.numerical.common.FormatUtil.FormatDouble (dblBondCoupon, 1, 4, 100.)</span>
				+ &quot; &quot; + dtMaturity, strBondCouponCurrency, strIssuerName, dblBondCoupon,
					iBondCouponFrequency, strBondCouponDayCount, dtEffective, dtMaturity, null, null);

<span class="pc bpc" id="L673" title="1 of 2 branches missed.">		if (null == bond) return null;</span>

<span class="fc" id="L675">		org.drip.param.quote.ProductMultiMeasure pmm = new org.drip.param.quote.ProductMultiMeasure();</span>

		try {
<span class="fc" id="L678">			pmm.addQuote (&quot;Price&quot;, new org.drip.param.quote.MultiSided (&quot;mid&quot;, dblBondMarketCleanPrice),</span>
				true);
<span class="nc" id="L680">		} catch (java.lang.Exception e) {</span>
<span class="fc" id="L681">		}</span>

<span class="fc" id="L683">		csqc.setProductQuote (bond.name(), pmm);</span>

<span class="fc" id="L685">		org.drip.state.discount.MergedDiscountForwardCurve dcFunding =</span>
<span class="fc" id="L686">			org.drip.service.template.LatentMarketStateBuilder.SmoothFundingCurve (dtSpot,</span>
				strBondCouponCurrency, astrFundingCurveDepositTenor, adblFundingCurveDepositQuote,
					strFundingCurveDepositMeasure, adblFundingCurveFuturesQuote,
						strFundingCurveFuturesMeasure, astrFundingCurveFixFloatTenor,
							adblFundingCurveFixFloatQuote, strFundingFixFloatMeasure);

<span class="fc" id="L692">		csqc.setFundingState (dcFunding);</span>

<span class="fc" id="L694">		csqc.setGovvieState (org.drip.service.template.LatentMarketStateBuilder.ShapePreservingGovvieCurve</span>
<span class="fc" id="L695">			(strGovvieCode, dtSpot, adtGovvieCurveTreasuryEffective, adtGovvieCurveTreasuryMaturity,</span>
				adblGovvieCurveTreasuryCoupon, adblGovvieCurveTreasuryYield, strGovvieCurveTreasuryMeasure));

<span class="fc" id="L698">		csqc.setCreditState (org.drip.service.template.LatentMarketStateBuilder.CreditCurve (dtSpot,</span>
			strCreditCurveName, astrCreditCurveCDSTenor, adblCreditCurveCDSCoupon, adblCreditCurveCDSQuote,
				strCreditCurveCDSMeasure, dcFunding));

<span class="fc" id="L702">		org.drip.param.valuation.ValuationParams valParams = org.drip.param.valuation.ValuationParams.Spot</span>
<span class="fc" id="L703">			(iSpotDate);</span>

<span class="fc" id="L705">		return bond.standardMeasures (valParams, null, csqc, null, bond.exerciseYieldFromPrice (valParams,</span>
			csqc, null, dblBondMarketCleanPrice), dblBondMarketCleanPrice);
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>